{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to Fan Qing Song's Site","text":"<p>\u6b22\u8fce\u6765\u5230\u6211\u7684\u4e2a\u4eba\u7f51\u7ad9\uff01\u8fd9\u91cc\u5305\u542b\u6211\u7684\u81ea\u6211\u4ecb\u7ecd\u548c\u77e5\u8bc6\u5e93\u3002</p>"},{"location":"#_1","title":"\u7f51\u7ad9\u7ed3\u6784","text":""},{"location":"#_2","title":"\ud83d\udc64 \u5173\u4e8e\u6211","text":"<ul> <li>\u4e2a\u4eba\u7b80\u5386\u548c\u81ea\u6211\u4ecb\u7ecd</li> <li>\u6280\u80fd\u548c\u7ecf\u9a8c</li> <li>\u9879\u76ee\u5c55\u793a</li> </ul>"},{"location":"#_3","title":"\ud83d\udcda \u77e5\u8bc6\u5e93","text":"<ul> <li>\u901f\u67e5\u8868: \u5e38\u7528\u547d\u4ee4\u548c\u6280\u5de7</li> <li>Linux: Linux \u7cfb\u7edf\u547d\u4ee4</li> <li>Git: Git \u7248\u672c\u63a7\u5236\u547d\u4ee4</li> <li>Node.js: Node.js \u76f8\u5173\u547d\u4ee4</li> <li>Docker: \u5bb9\u5668\u5316\u6280\u672f</li> <li>\u5bb9\u5668\u7ba1\u7406</li> <li>\u955c\u50cf\u64cd\u4f5c</li> <li>\u6742\u9879\u6280\u5de7</li> <li>MySQL: \u6570\u636e\u5e93\u64cd\u4f5c</li> <li>WSL \u73af\u5883\u5b89\u88c5</li> <li>\u5e38\u7528\u547d\u4ee4</li> <li>Python: Python \u5f00\u53d1</li> <li>SQLAlchemy: ORM \u6846\u67b6</li> <li>SQLAlchemy \u57fa\u7840</li> <li>Alembic \u8fc1\u79fb</li> </ul>"},{"location":"#devops","title":"\ud83d\udd27 DevOps","text":"<ul> <li>PostgreSQL \u540c\u6b65: \u6570\u636e\u5e93\u540c\u6b65\u811a\u672c</li> <li>Neo4j \u540c\u6b65: \u56fe\u6570\u636e\u5e93\u540c\u6b65\u811a\u672c</li> </ul>"},{"location":"#_4","title":"\u5feb\u901f\u5f00\u59cb","text":"<pre><code># \u672c\u5730\u5f00\u53d1\nmkdocs serve\n\n# \u6784\u5efa\u9759\u6001\u6587\u4ef6\nmkdocs build\n</code></pre>"},{"location":"#_5","title":"\u6280\u672f\u6808","text":"<ul> <li>\u6587\u6863\u751f\u6210: MkDocs + Material Theme</li> <li>\u7b80\u5386: Vue.js \u52a8\u6001\u7b80\u5386</li> <li>\u77e5\u8bc6\u7ba1\u7406: Markdown + \u7ed3\u6784\u5316\u5bfc\u822a</li> </ul> <p>\u8fd9\u4e2a\u7f51\u7ad9\u4f1a\u6301\u7eed\u66f4\u65b0\uff0c\u6b22\u8fce\u5173\u6ce8\uff01</p>"},{"location":"about-me/","title":"\u5173\u4e8e\u6211","text":""},{"location":"about-me/#_2","title":"\ud83d\udc4b \u4f60\u597d\uff0c\u6211\u662f\u996d\u996d","text":"<p>\u4e00\u4e2a\u70ed\u7231\u6280\u672f\u7684\u5168\u6808\u5f00\u53d1\u8005</p>"},{"location":"about-me/#_3","title":"\ud83c\udfaf \u4e2a\u4eba\u7b80\u4ecb","text":"<p>\u6211\u662f\u4e00\u540d\u5145\u6ee1\u6fc0\u60c5\u7684\u8f6f\u4ef6\u5f00\u53d1\u8005\uff0c\u4e13\u6ce8\u4e8e Web \u5f00\u53d1\u548c\u7cfb\u7edf\u67b6\u6784\u3002\u559c\u6b22\u63a2\u7d22\u65b0\u6280\u672f\uff0c\u89e3\u51b3\u590d\u6742\u95ee\u9898\uff0c\u5e76\u81f4\u529b\u4e8e\u521b\u9020\u6709\u4ef7\u503c\u7684\u8f6f\u4ef6\u4ea7\u54c1\u3002</p>"},{"location":"about-me/#_4","title":"\ud83d\udee0\ufe0f \u6280\u672f\u6808","text":""},{"location":"about-me/#_5","title":"\u524d\u7aef\u6280\u672f","text":"<ul> <li>\u6846\u67b6: Vue.js, React, Angular</li> <li>\u6837\u5f0f: CSS3, Sass, Tailwind CSS</li> <li>\u6784\u5efa\u5de5\u5177: Webpack, Vite, Rollup</li> <li>\u72b6\u6001\u7ba1\u7406: Vuex, Redux, Pinia</li> </ul>"},{"location":"about-me/#_6","title":"\u540e\u7aef\u6280\u672f","text":"<ul> <li>\u8bed\u8a00: Python, Node.js, Java</li> <li>\u6846\u67b6: Django, Flask, Express.js, Spring Boot</li> <li>\u6570\u636e\u5e93: MySQL, PostgreSQL, MongoDB, Redis</li> <li>ORM: SQLAlchemy, Prisma, TypeORM</li> </ul>"},{"location":"about-me/#_7","title":"\u8fd0\u7ef4\u548c\u5de5\u5177","text":"<ul> <li>\u5bb9\u5668\u5316: Docker, Kubernetes</li> <li>\u4e91\u670d\u52a1: AWS, Azure, Google Cloud</li> <li>CI/CD: GitHub Actions, Jenkins, GitLab CI</li> <li>\u76d1\u63a7: Prometheus, Grafana, ELK Stack</li> </ul>"},{"location":"about-me/#_8","title":"\ud83d\udcbc \u5de5\u4f5c\u7ecf\u9a8c","text":""},{"location":"about-me/#_9","title":"\u9ad8\u7ea7\u5168\u6808\u5f00\u53d1\u5de5\u7a0b\u5e08","text":"<p>2022 - \u81f3\u4eca</p> <ul> <li>\u8d1f\u8d23\u516c\u53f8\u6838\u5fc3\u4ea7\u54c1\u7684\u67b6\u6784\u8bbe\u8ba1\u548c\u5f00\u53d1</li> <li>\u5e26\u9886\u56e2\u961f\u5b8c\u6210\u591a\u4e2a\u91cd\u8981\u9879\u76ee</li> <li>\u4f18\u5316\u7cfb\u7edf\u6027\u80fd\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c</li> <li>\u53c2\u4e0e\u6280\u672f\u9009\u578b\u548c\u67b6\u6784\u51b3\u7b56</li> </ul>"},{"location":"about-me/#_10","title":"\u524d\u7aef\u5f00\u53d1\u5de5\u7a0b\u5e08","text":"<p>2020 - 2022</p> <ul> <li>\u5f00\u53d1\u54cd\u5e94\u5f0f Web \u5e94\u7528</li> <li>\u5b9e\u73b0\u590d\u6742\u7684\u524d\u7aef\u4ea4\u4e92\u529f\u80fd</li> <li>\u4e0e\u540e\u7aef\u56e2\u961f\u534f\u4f5c\u5b8c\u6210\u9879\u76ee</li> <li>\u53c2\u4e0e\u4ee3\u7801\u5ba1\u67e5\u548c\u6280\u672f\u5206\u4eab</li> </ul>"},{"location":"about-me/#_11","title":"\ud83c\udf93 \u6559\u80b2\u80cc\u666f","text":"<ul> <li>\u8ba1\u7b97\u673a\u79d1\u5b66\u4e0e\u6280\u672f - \u67d0\u77e5\u540d\u5927\u5b66</li> <li>\u8f6f\u4ef6\u5de5\u7a0b - \u67d0\u6280\u672f\u5b66\u9662</li> </ul>"},{"location":"about-me/#_12","title":"\ud83c\udfc6 \u9879\u76ee\u5c55\u793a","text":""},{"location":"about-me/#_13","title":"\u9879\u76ee\u4e00\uff1a\u4f01\u4e1a\u7ba1\u7406\u7cfb\u7edf","text":"<ul> <li>\u6280\u672f\u6808: Vue.js + Node.js + MySQL</li> <li>\u63cf\u8ff0: \u5b8c\u6574\u7684\u4f01\u4e1a\u7ea7\u7ba1\u7406\u7cfb\u7edf\uff0c\u5305\u542b\u7528\u6237\u7ba1\u7406\u3001\u6743\u9650\u63a7\u5236\u3001\u6570\u636e\u7edf\u8ba1\u7b49\u529f\u80fd</li> <li>\u6210\u679c: \u63d0\u5347\u4e86\u516c\u53f8\u8fd0\u8425\u6548\u7387 30%</li> </ul>"},{"location":"about-me/#_14","title":"\u9879\u76ee\u4e8c\uff1a\u7535\u5546\u5e73\u53f0","text":"<ul> <li>\u6280\u672f\u6808: React + Python + PostgreSQL</li> <li>\u63cf\u8ff0: \u73b0\u4ee3\u5316\u7684\u7535\u5546\u5e73\u53f0\uff0c\u652f\u6301\u591a\u5546\u6237\u3001\u591a\u652f\u4ed8\u65b9\u5f0f</li> <li>\u6210\u679c: \u6708\u6d3b\u7528\u6237\u8d85\u8fc7 10 \u4e07</li> </ul>"},{"location":"about-me/#_15","title":"\u9879\u76ee\u4e09\uff1a\u6570\u636e\u53ef\u89c6\u5316\u5e73\u53f0","text":"<ul> <li>\u6280\u672f\u6808: Vue.js + Python + Redis</li> <li>\u63cf\u8ff0: \u5b9e\u65f6\u6570\u636e\u76d1\u63a7\u548c\u53ef\u89c6\u5316\u5c55\u793a\u5e73\u53f0</li> <li>\u6210\u679c: \u5e2e\u52a9\u5ba2\u6237\u66f4\u597d\u5730\u7406\u89e3\u4e1a\u52a1\u6570\u636e</li> </ul>"},{"location":"about-me/#_16","title":"\ud83c\udf1f \u6280\u80fd\u7279\u70b9","text":"<ul> <li>\u5168\u6808\u5f00\u53d1: \u4ece\u524d\u7aef\u5230\u540e\u7aef\uff0c\u4ece\u6570\u636e\u5e93\u5230\u90e8\u7f72\uff0c\u5168\u6d41\u7a0b\u638c\u63e1</li> <li>\u95ee\u9898\u89e3\u51b3: \u5584\u4e8e\u5206\u6790\u590d\u6742\u95ee\u9898\uff0c\u63d0\u4f9b\u6700\u4f18\u89e3\u51b3\u65b9\u6848</li> <li>\u56e2\u961f\u534f\u4f5c: \u826f\u597d\u7684\u6c9f\u901a\u80fd\u529b\uff0c\u80fd\u591f\u6709\u6548\u5e26\u9886\u56e2\u961f</li> <li>\u6301\u7eed\u5b66\u4e60: \u4fdd\u6301\u5bf9\u65b0\u6280\u672f\u7684\u654f\u611f\u5ea6\uff0c\u6301\u7eed\u63d0\u5347\u6280\u80fd</li> </ul>"},{"location":"about-me/#_17","title":"\ud83d\udceb \u8054\u7cfb\u65b9\u5f0f","text":"<ul> <li>\u90ae\u7bb1: qsfan@qq.com</li> <li>GitHub: fanqingsong</li> <li>LinkedIn: Fan Qing Song</li> </ul>"},{"location":"about-me/#_18","title":"\ud83c\udfaf \u672a\u6765\u89c4\u5212","text":"<ul> <li>\u6df1\u5165\u7814\u7a76\u4e91\u539f\u751f\u6280\u672f</li> <li>\u63a2\u7d22\u4eba\u5de5\u667a\u80fd\u548c\u673a\u5668\u5b66\u4e60</li> <li>\u53c2\u4e0e\u5f00\u6e90\u9879\u76ee\u8d21\u732e</li> <li>\u5206\u4eab\u6280\u672f\u7ecf\u9a8c\u548c\u5fc3\u5f97</li> </ul> <p>\u611f\u8c22\u60a8\u82b1\u65f6\u95f4\u4e86\u89e3\u6211\uff01\u5982\u679c\u60a8\u5bf9\u6211\u7684\u7ecf\u5386\u548c\u6280\u80fd\u611f\u5174\u8da3\uff0c\u6b22\u8fce\u8054\u7cfb\u6211\u8fdb\u884c\u4ea4\u6d41\u3002 </p>"},{"location":"devops/neo4j-backup/","title":"Neo4j \u5907\u4efd\u811a\u672c","text":""},{"location":"devops/neo4j-backup/#_1","title":"\ud83d\udccb \u6982\u8ff0","text":"<p>\u8fd9\u4e2a\u811a\u672c\u4e13\u95e8\u7528\u4e8e Neo4j \u56fe\u6570\u636e\u5e93\u7684\u5907\u4efd\u64cd\u4f5c\uff0c\u652f\u6301\u5168\u91cf\u5907\u4efd\u3001\u589e\u91cf\u5907\u4efd\u548c\u5728\u7ebf\u5907\u4efd\u3002</p>"},{"location":"devops/neo4j-backup/#_2","title":"\ud83d\ude80 \u5907\u4efd\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n# Neo4j \u5907\u4efd\u811a\u672c\nset -euo pipefail\n\n# \u989c\u8272\u5b9a\u4e49\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# \u65e5\u5fd7\u51fd\u6570\nlog_info() {\n    echo -e \"${BLUE}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\n# \u73af\u5883\u53d8\u91cf\u914d\u7f6e\nNEO4J_HOST=\"${NEO4J_HOST:-localhost}\"\nNEO4J_PORT=\"${NEO4J_PORT:-7687}\"\nNEO4J_USER=\"${NEO4J_USER:-neo4j}\"\nNEO4J_PASSWORD=\"${NEO4J_PASSWORD:-password}\"\n\nNEO4J_HOME=\"${NEO4J_HOME:-/var/lib/neo4j}\"\nNEO4J_DATA_DIR=\"${NEO4J_DATA_DIR:-$NEO4J_HOME/data}\"\nNEO4J_BACKUP_DIR=\"${NEO4J_BACKUP_DIR:-/backup/neo4j}\"\nBACKUP_RETENTION_DAYS=\"${BACKUP_RETENTION_DAYS:-7}\"\nBACKUP_TYPE=\"${BACKUP_TYPE:-full}\"  # full, incremental, online\n\n# \u68c0\u67e5\u4f9d\u8d56\ncheck_dependencies() {\n    log_info \"\u68c0\u67e5\u4f9d\u8d56...\"\n\n    if ! command -v cypher-shell &amp;&gt; /dev/null; then\n        log_error \"cypher-shell \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if ! command -v neo4j-admin &amp;&gt; /dev/null; then\n        log_warning \"neo4j-admin \u672a\u5b89\u88c5\uff0c\u5c06\u4f7f\u7528 cypher-shell \u5907\u4efd\"\n    fi\n\n    if ! command -v jq &amp;&gt; /dev/null; then\n        log_warning \"jq \u672a\u5b89\u88c5\uff0c\u5c06\u4f7f\u7528\u57fa\u672c\u683c\u5f0f\u8f93\u51fa\"\n    fi\n\n    log_success \"\u4f9d\u8d56\u68c0\u67e5\u5b8c\u6210\"\n}\n\n# \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5\ntest_connection() {\n    log_info \"\u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5...\"\n\n    if ! echo \"RETURN 1;\" | cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" -u \"$NEO4J_USER\" -p \"$NEO4J_PASSWORD\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230 Neo4j \u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    log_success \"\u6570\u636e\u5e93\u8fde\u63a5\u6d4b\u8bd5\u901a\u8fc7\"\n}\n\n# \u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f\nget_db_info() {\n    log_info \"\u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f...\"\n\n    # \u83b7\u53d6\u8282\u70b9\u6570\u91cf\n    local node_count=$(echo \"MATCH (n) RETURN count(n) as count;\" | \\\n    cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" -u \"$NEO4J_USER\" -p \"$NEO4J_PASSWORD\" --format plain | \\\n    tail -1)\n\n    # \u83b7\u53d6\u5173\u7cfb\u6570\u91cf\n    local rel_count=$(echo \"MATCH ()-[r]-&gt;() RETURN count(r) as count;\" | \\\n    cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" -u \"$NEO4J_USER\" -p \"$NEO4J_PASSWORD\" --format plain | \\\n    tail -1)\n\n    # \u83b7\u53d6\u6570\u636e\u5e93\u7248\u672c\n    local version=$(echo \"CALL dbms.components() YIELD name, versions, edition RETURN name, versions[0] as version, edition;\" | \\\n    cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" -u \"$NEO4J_USER\" -p \"$NEO4J_PASSWORD\" --format plain | \\\n    tail -1)\n\n    log_info \"\u8282\u70b9\u6570\u91cf: $node_count\"\n    log_info \"\u5173\u7cfb\u6570\u91cf: $rel_count\"\n    log_info \"\u6570\u636e\u5e93\u7248\u672c: $version\"\n}\n\n# \u521b\u5efa\u5907\u4efd\u76ee\u5f55\ncreate_backup_dir() {\n    log_info \"\u521b\u5efa\u5907\u4efd\u76ee\u5f55...\"\n    mkdir -p \"$NEO4J_BACKUP_DIR\"\n    log_success \"\u5907\u4efd\u76ee\u5f55\u521b\u5efa\u5b8c\u6210: $NEO4J_BACKUP_DIR\"\n}\n\n# \u4f7f\u7528 neo4j-admin \u5907\u4efd\nperform_admin_backup() {\n    log_info \"\u4f7f\u7528 neo4j-admin \u6267\u884c\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_name=\"neo4j_admin_backup_${timestamp}\"\n    local backup_path=\"$NEO4J_BACKUP_DIR/$backup_name\"\n\n    # \u68c0\u67e5 neo4j-admin \u662f\u5426\u53ef\u7528\n    if ! command -v neo4j-admin &amp;&gt; /dev/null; then\n        log_error \"neo4j-admin \u4e0d\u53ef\u7528\"\n        return 1\n    fi\n\n    # \u6267\u884c\u5907\u4efd\n    if neo4j-admin backup --from=\"bolt://$NEO4J_HOST:$NEO4J_PORT\" \\\n        --backup-dir=\"$backup_path\" \\\n        --username=\"$NEO4J_USER\" \\\n        --password=\"$NEO4J_PASSWORD\" \\\n        --database=neo4j \\\n        --verbose; then\n\n        log_success \"neo4j-admin \u5907\u4efd\u5b8c\u6210: $backup_path\"\n        echo \"$backup_path\"\n    else\n        log_error \"neo4j-admin \u5907\u4efd\u5931\u8d25\"\n        return 1\n    fi\n}\n\n# \u4f7f\u7528 cypher-shell \u5907\u4efd\nperform_cypher_backup() {\n    log_info \"\u4f7f\u7528 cypher-shell \u6267\u884c\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$NEO4J_BACKUP_DIR/neo4j_cypher_backup_${timestamp}.cypher\"\n\n    # \u521b\u5efa\u5907\u4efd\u811a\u672c\n    cat &gt; \"$backup_file\" &lt;&lt; 'EOF'\n// Neo4j \u6570\u636e\u5907\u4efd\u811a\u672c\n// \u5bfc\u51fa\u6240\u6709\u8282\u70b9\nMATCH (n) RETURN n;\n\n// \u5bfc\u51fa\u6240\u6709\u5173\u7cfb\nMATCH ()-[r]-&gt;() RETURN r;\n\n// \u5bfc\u51fa\u7d22\u5f15\u4fe1\u606f\nSHOW INDEXES;\n\n// \u5bfc\u51fa\u7ea6\u675f\u4fe1\u606f\nSHOW CONSTRAINTS;\n\n// \u5bfc\u51fa\u6570\u636e\u5e93\u7edf\u8ba1\u4fe1\u606f\nCALL db.stats.retrieve('GRAPH COUNTS') YIELD data RETURN data;\nEOF\n\n    # \u6267\u884c\u5907\u4efd\n    if cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" \\\n        -u \"$NEO4J_USER\" \\\n        -p \"$NEO4J_PASSWORD\" \\\n        --format plain \\\n        &lt; \"$backup_file\" &gt; \"${backup_file}.data\"; then\n\n        log_success \"cypher-shell \u5907\u4efd\u5b8c\u6210: $backup_file\"\n        echo \"$backup_file\"\n    else\n        log_error \"cypher-shell \u5907\u4efd\u5931\u8d25\"\n        return 1\n    fi\n}\n\n# \u5728\u7ebf\u5907\u4efd\nperform_online_backup() {\n    log_info \"\u6267\u884c\u5728\u7ebf\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$NEO4J_BACKUP_DIR/neo4j_online_backup_${timestamp}.cypher\"\n\n    # \u521b\u5efa\u5728\u7ebf\u5907\u4efd\u811a\u672c\n    cat &gt; \"$backup_file\" &lt;&lt; 'EOF'\n// \u5728\u7ebf\u5907\u4efd\u811a\u672c\n// \u83b7\u53d6\u6240\u6709\u6807\u7b7e\nCALL db.labels() YIELD label RETURN label;\n\n// \u83b7\u53d6\u6240\u6709\u5173\u7cfb\u7c7b\u578b\nCALL db.relationshipTypes() YIELD relationshipType RETURN relationshipType;\n\n// \u6309\u6807\u7b7e\u5907\u4efd\u8282\u70b9\nCALL db.labels() YIELD label\nCALL {\n  WITH label\n  MATCH (n:`${label}`) \n  RETURN label, collect(n) as nodes\n} RETURN label, size(nodes) as node_count;\n\n// \u6309\u5173\u7cfb\u7c7b\u578b\u5907\u4efd\u5173\u7cfb\nCALL db.relationshipTypes() YIELD relationshipType\nCALL {\n  WITH relationshipType\n  MATCH ()-[r:`${relationshipType}`]-&gt;() \n  RETURN relationshipType, collect(r) as relationships\n} RETURN relationshipType, size(relationships) as rel_count;\nEOF\n\n    # \u6267\u884c\u5728\u7ebf\u5907\u4efd\n    if cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" \\\n        -u \"$NEO4J_USER\" \\\n        -p \"$NEO4J_PASSWORD\" \\\n        --format plain \\\n        &lt; \"$backup_file\" &gt; \"${backup_file}.data\"; then\n\n        log_success \"\u5728\u7ebf\u5907\u4efd\u5b8c\u6210: $backup_file\"\n        echo \"$backup_file\"\n    else\n        log_error \"\u5728\u7ebf\u5907\u4efd\u5931\u8d25\"\n        return 1\n    fi\n}\n\n# \u589e\u91cf\u5907\u4efd\nperform_incremental_backup() {\n    log_info \"\u6267\u884c\u589e\u91cf\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$NEO4J_BACKUP_DIR/neo4j_incremental_backup_${timestamp}.cypher\"\n\n    # \u521b\u5efa\u589e\u91cf\u5907\u4efd\u811a\u672c\uff08\u57fa\u4e8e\u65f6\u95f4\u6233\uff09\n    cat &gt; \"$backup_file\" &lt;&lt; 'EOF'\n// \u589e\u91cf\u5907\u4efd\u811a\u672c\n// \u83b7\u53d6\u4e0a\u6b21\u5907\u4efd\u65f6\u95f4\uff08\u8fd9\u91cc\u4f7f\u7528\u793a\u4f8b\u65f6\u95f4\u6233\uff09\nWITH datetime('2024-01-01T00:00:00') as last_backup_time\n\n// \u5907\u4efd\u65b0\u589e\u7684\u8282\u70b9\nMATCH (n) \nWHERE n.created_at &gt; last_backup_time OR n.updated_at &gt; last_backup_time\nRETURN n;\n\n// \u5907\u4efd\u65b0\u589e\u7684\u5173\u7cfb\nMATCH ()-[r]-&gt;() \nWHERE r.created_at &gt; last_backup_time OR r.updated_at &gt; last_backup_time\nRETURN r;\n\n// \u5907\u4efd\u4fee\u6539\u7684\u8282\u70b9\nMATCH (n) \nWHERE n.updated_at &gt; last_backup_time\nRETURN n;\nEOF\n\n    # \u6267\u884c\u589e\u91cf\u5907\u4efd\n    if cypher-shell -a \"bolt://$NEO4J_HOST:$NEO4J_PORT\" \\\n        -u \"$NEO4J_USER\" \\\n        -p \"$NEO4J_PASSWORD\" \\\n        --format plain \\\n        &lt; \"$backup_file\" &gt; \"${backup_file}.data\"; then\n\n        log_success \"\u589e\u91cf\u5907\u4efd\u5b8c\u6210: $backup_file\"\n        echo \"$backup_file\"\n    else\n        log_error \"\u589e\u91cf\u5907\u4efd\u5931\u8d25\"\n        return 1\n    fi\n}\n\n# \u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6\nverify_backup() {\n    local backup_file=$1\n    log_info \"\u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6: $backup_file\"\n\n    if [[ ! -f \"$backup_file\" ]]; then\n        log_error \"\u5907\u4efd\u6587\u4ef6\u4e0d\u5b58\u5728\"\n        return 1\n    fi\n\n    # \u68c0\u67e5\u6587\u4ef6\u5927\u5c0f\n    local file_size=$(du -h \"$backup_file\" | cut -f1)\n    log_info \"\u5907\u4efd\u6587\u4ef6\u5927\u5c0f: $file_size\"\n\n    # \u68c0\u67e5\u6587\u4ef6\u5185\u5bb9\n    if [[ -f \"${backup_file}.data\" ]]; then\n        local line_count=$(wc -l &lt; \"${backup_file}.data\")\n        log_info \"\u5907\u4efd\u6570\u636e\u884c\u6570: $line_count\"\n    fi\n\n    log_success \"\u5907\u4efd\u6587\u4ef6\u9a8c\u8bc1\u901a\u8fc7\"\n}\n\n# \u6e05\u7406\u65e7\u5907\u4efd\ncleanup_old_backups() {\n    log_info \"\u6e05\u7406\u65e7\u5907\u4efd\u6587\u4ef6...\"\n\n    local deleted_count=0\n\n    # \u6e05\u7406 cypher \u5907\u4efd\u6587\u4ef6\n    if [[ -d \"$NEO4J_BACKUP_DIR\" ]]; then\n        deleted_count=$(find \"$NEO4J_BACKUP_DIR\" -name \"neo4j_*_backup_*\" -mtime +\"$BACKUP_RETENTION_DAYS\" | wc -l)\n        find \"$NEO4J_BACKUP_DIR\" -name \"neo4j_*_backup_*\" -mtime +\"$BACKUP_RETENTION_DAYS\" -delete\n    fi\n\n    # \u6e05\u7406 admin \u5907\u4efd\u76ee\u5f55\n    if [[ -d \"$NEO4J_BACKUP_DIR\" ]]; then\n        local admin_deleted=$(find \"$NEO4J_BACKUP_DIR\" -name \"neo4j_admin_backup_*\" -type d -mtime +\"$BACKUP_RETENTION_DAYS\" | wc -l)\n        find \"$NEO4J_BACKUP_DIR\" -name \"neo4j_admin_backup_*\" -type d -mtime +\"$BACKUP_RETENTION_DAYS\" -exec rm -rf {} +\n        deleted_count=$((deleted_count + admin_deleted))\n    fi\n\n    log_success \"\u6e05\u7406\u5b8c\u6210\uff0c\u5220\u9664\u4e86 $deleted_count \u4e2a\u65e7\u5907\u4efd\u6587\u4ef6\"\n}\n\n# \u751f\u6210\u5907\u4efd\u62a5\u544a\ngenerate_backup_report() {\n    local backup_file=$1\n    log_info \"\u751f\u6210\u5907\u4efd\u62a5\u544a...\"\n\n    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')\n    local report_file=\"$NEO4J_BACKUP_DIR/backup_report_$(date '+%Y%m%d').txt\"\n\n    cat &gt;&gt; \"$report_file\" &lt;&lt; EOF\n=== Neo4j \u5907\u4efd\u62a5\u544a ===\n\u5907\u4efd\u65f6\u95f4: $timestamp\n\u6570\u636e\u5e93: Neo4j\n\u4e3b\u673a: $NEO4J_HOST:$NEO4J_PORT\n\u5907\u4efd\u7c7b\u578b: $BACKUP_TYPE\n\u5907\u4efd\u6587\u4ef6: $backup_file\n\u6587\u4ef6\u5927\u5c0f: $(du -h \"$backup_file\" | cut -f1)\n\nEOF\n\n    log_success \"\u5907\u4efd\u62a5\u544a\u5df2\u751f\u6210: $report_file\"\n}\n\n# \u4e3b\u51fd\u6570\nmain() {\n    log_info \"\u5f00\u59cb Neo4j \u5907\u4efd...\"\n\n    check_dependencies\n    test_connection\n    get_db_info\n    create_backup_dir\n\n    local backup_file=\"\"\n\n    case \"$BACKUP_TYPE\" in\n        \"full\")\n            # \u5c1d\u8bd5\u4f7f\u7528 neo4j-admin\uff0c\u5982\u679c\u5931\u8d25\u5219\u4f7f\u7528 cypher-shell\n            if ! backup_file=$(perform_admin_backup); then\n                log_warning \"neo4j-admin \u5907\u4efd\u5931\u8d25\uff0c\u4f7f\u7528 cypher-shell\"\n                backup_file=$(perform_cypher_backup)\n            fi\n            ;;\n        \"incremental\")\n            backup_file=$(perform_incremental_backup)\n            ;;\n        \"online\")\n            backup_file=$(perform_online_backup)\n            ;;\n        *)\n            log_error \"\u4e0d\u652f\u6301\u7684\u5907\u4efd\u7c7b\u578b: $BACKUP_TYPE\"\n            log_info \"\u652f\u6301\u7684\u5907\u4efd\u7c7b\u578b: full, incremental, online\"\n            exit 1\n            ;;\n    esac\n\n    # \u9a8c\u8bc1\u5907\u4efd\n    if [[ -n \"$backup_file\" ]]; then\n        verify_backup \"$backup_file\"\n        generate_backup_report \"$backup_file\"\n    fi\n\n    # \u6e05\u7406\u65e7\u5907\u4efd\n    cleanup_old_backups\n\n    log_success \"Neo4j \u5907\u4efd\u5b8c\u6210\uff01\"\n}\n\n# \u811a\u672c\u5165\u53e3\nif [[ \"${BASH_SOURCE[0]}\" == \"${0}\" ]]; then\n    main \"$@\"\nfi\n</code></pre>"},{"location":"devops/neo4j-backup/#_3","title":"\ud83d\udd27 \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"devops/neo4j-backup/#1","title":"1. \u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<pre><code># Neo4j \u914d\u7f6e\nexport NEO4J_HOST=\"localhost\"\nexport NEO4J_PORT=\"7687\"\nexport NEO4J_USER=\"neo4j\"\nexport NEO4J_PASSWORD=\"password\"\n\n# \u5907\u4efd\u914d\u7f6e\nexport NEO4J_BACKUP_DIR=\"/backup/neo4j\"\nexport BACKUP_RETENTION_DAYS=\"7\"\nexport BACKUP_TYPE=\"full\"  # full, incremental, online\n</code></pre>"},{"location":"devops/neo4j-backup/#2","title":"2. \u6267\u884c\u5907\u4efd","text":"<pre><code># \u5168\u91cf\u5907\u4efd\nexport BACKUP_TYPE=\"full\"\n./neo4j-backup.sh\n\n# \u589e\u91cf\u5907\u4efd\nexport BACKUP_TYPE=\"incremental\"\n./neo4j-backup.sh\n\n# \u5728\u7ebf\u5907\u4efd\nexport BACKUP_TYPE=\"online\"\n./neo4j-backup.sh\n</code></pre>"},{"location":"devops/neo4j-backup/#3","title":"3. \u5b9a\u65f6\u5907\u4efd","text":"<pre><code># \u6bcf\u5929\u51cc\u66683\u70b9\u6267\u884c\u5168\u91cf\u5907\u4efd\n0 3 * * * /path/to/neo4j-backup.sh &gt;&gt; /var/log/neo4j-backup.log 2&gt;&amp;1\n\n# \u6bcf\u5c0f\u65f6\u6267\u884c\u589e\u91cf\u5907\u4efd\n0 * * * * export BACKUP_TYPE=\"incremental\" &amp;&amp; /path/to/neo4j-backup.sh &gt;&gt; /var/log/neo4j-backup.log 2&gt;&amp;1\n</code></pre>"},{"location":"devops/neo4j-backup/#_4","title":"\ud83d\udcca \u5907\u4efd\u7c7b\u578b\u8bf4\u660e","text":"\u5907\u4efd\u7c7b\u578b \u8bf4\u660e \u9002\u7528\u573a\u666f <code>full</code> \u5168\u91cf\u5907\u4efd\uff0c\u5305\u542b\u6240\u6709\u6570\u636e \u5b8c\u6574\u5907\u4efd\uff0c\u707e\u96be\u6062\u590d <code>incremental</code> \u589e\u91cf\u5907\u4efd\uff0c\u57fa\u4e8e\u65f6\u95f4\u6233 \u9891\u7e41\u5907\u4efd\uff0c\u6700\u5c0f\u5316\u6570\u636e\u4e22\u5931 <code>online</code> \u5728\u7ebf\u5907\u4efd\uff0c\u4e0d\u505c\u6b62\u670d\u52a1 \u751f\u4ea7\u73af\u5883\uff0c\u96f6\u505c\u673a\u5907\u4efd"},{"location":"devops/neo4j-backup/#_5","title":"\ud83d\udcdd \u76d1\u63a7\u548c\u544a\u8b66","text":"<pre><code># \u68c0\u67e5\u5907\u4efd\u72b6\u6001\ngrep \"SUCCESS.*\u5907\u4efd\u5b8c\u6210\" /var/log/neo4j-backup.log | tail -1\n\n# \u68c0\u67e5\u5907\u4efd\u6587\u4ef6\u5927\u5c0f\nls -lh /backup/neo4j/\n\n# \u68c0\u67e5\u5907\u4efd\u6587\u4ef6\u6570\u91cf\nfind /backup/neo4j/ -name \"neo4j_*_backup_*\" | wc -l\n</code></pre>"},{"location":"devops/postgres-backup/","title":"PostgreSQL \u5907\u4efd\u811a\u672c","text":""},{"location":"devops/postgres-backup/#_1","title":"\ud83d\udccb \u6982\u8ff0","text":"<p>\u8fd9\u4e2a\u811a\u672c\u4e13\u95e8\u7528\u4e8e PostgreSQL \u6570\u636e\u5e93\u7684\u5907\u4efd\u64cd\u4f5c\uff0c\u652f\u6301\u5168\u91cf\u5907\u4efd\u3001\u589e\u91cf\u5907\u4efd\u548c\u538b\u7f29\u5907\u4efd\u3002</p>"},{"location":"devops/postgres-backup/#_2","title":"\ud83d\ude80 \u5907\u4efd\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n# PostgreSQL \u5907\u4efd\u811a\u672c\nset -euo pipefail\n\n# \u989c\u8272\u5b9a\u4e49\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# \u65e5\u5fd7\u51fd\u6570\nlog_info() {\n    echo -e \"${BLUE}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\n# \u73af\u5883\u53d8\u91cf\u914d\u7f6e\nDB_HOST=\"${DB_HOST:-localhost}\"\nDB_PORT=\"${DB_PORT:-5432}\"\nDB_NAME=\"${DB_NAME:-postgres}\"\nDB_USER=\"${DB_USER:-postgres}\"\nDB_PASSWORD=\"${DB_PASSWORD:-}\"\n\nBACKUP_DIR=\"${BACKUP_DIR:-/backup/postgres}\"\nBACKUP_RETENTION_DAYS=\"${BACKUP_RETENTION_DAYS:-7}\"\nCOMPRESS_BACKUP=\"${COMPRESS_BACKUP:-true}\"\nBACKUP_TYPE=\"${BACKUP_TYPE:-full}\"  # full, schema, data\n\n# \u68c0\u67e5\u4f9d\u8d56\ncheck_dependencies() {\n    log_info \"\u68c0\u67e5\u4f9d\u8d56...\"\n\n    if ! command -v pg_dump &amp;&gt; /dev/null; then\n        log_error \"pg_dump \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if ! command -v psql &amp;&gt; /dev/null; then\n        log_error \"psql \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if [[ \"$COMPRESS_BACKUP\" == \"true\" ]] &amp;&amp; ! command -v gzip &amp;&gt; /dev/null; then\n        log_warning \"gzip \u672a\u5b89\u88c5\uff0c\u5c06\u8df3\u8fc7\u538b\u7f29\"\n        COMPRESS_BACKUP=false\n    fi\n\n    log_success \"\u4f9d\u8d56\u68c0\u67e5\u5b8c\u6210\"\n}\n\n# \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5\ntest_connection() {\n    log_info \"\u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5...\"\n\n    if ! PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" -c \"SELECT 1;\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    log_success \"\u6570\u636e\u5e93\u8fde\u63a5\u6d4b\u8bd5\u901a\u8fc7\"\n}\n\n# \u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f\nget_db_info() {\n    log_info \"\u83b7\u53d6\u6570\u636e\u5e93\u4fe1\u606f...\"\n\n    local db_size=$(PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" -t -c \"\n        SELECT pg_size_pretty(pg_database_size('$DB_NAME'));\n    \" | xargs)\n\n    local table_count=$(PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" -t -c \"\n        SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';\n    \" | xargs)\n\n    log_info \"\u6570\u636e\u5e93\u5927\u5c0f: $db_size\"\n    log_info \"\u8868\u6570\u91cf: $table_count\"\n}\n\n# \u521b\u5efa\u5907\u4efd\u76ee\u5f55\ncreate_backup_dir() {\n    log_info \"\u521b\u5efa\u5907\u4efd\u76ee\u5f55...\"\n    mkdir -p \"$BACKUP_DIR\"\n    log_success \"\u5907\u4efd\u76ee\u5f55\u521b\u5efa\u5b8c\u6210: $BACKUP_DIR\"\n}\n\n# \u5168\u91cf\u5907\u4efd\nperform_full_backup() {\n    log_info \"\u6267\u884c\u5168\u91cf\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/${DB_NAME}_full_${timestamp}.sql\"\n\n    local pg_dump_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$DB_NAME\"\n        --verbose\n        --clean\n        --if-exists\n        --create\n        --no-owner\n        --no-privileges\n        --format=custom\n        -f \"$backup_file\"\n    )\n\n    if PGPASSWORD=\"$DB_PASSWORD\" pg_dump \"${pg_dump_args[@]}\"; then\n        log_success \"\u5168\u91cf\u5907\u4efd\u5b8c\u6210: $backup_file\"\n\n        # \u538b\u7f29\u5907\u4efd\u6587\u4ef6\n        if [[ \"$COMPRESS_BACKUP\" == \"true\" ]]; then\n            log_info \"\u538b\u7f29\u5907\u4efd\u6587\u4ef6...\"\n            gzip \"$backup_file\"\n            backup_file=\"${backup_file}.gz\"\n            log_success \"\u538b\u7f29\u5b8c\u6210: $backup_file\"\n        fi\n\n        echo \"$backup_file\"\n    else\n        log_error \"\u5168\u91cf\u5907\u4efd\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# Schema \u5907\u4efd\nperform_schema_backup() {\n    log_info \"\u6267\u884c Schema \u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/${DB_NAME}_schema_${timestamp}.sql\"\n\n    local pg_dump_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$DB_NAME\"\n        --verbose\n        --schema-only\n        --no-owner\n        --no-privileges\n        -f \"$backup_file\"\n    )\n\n    if PGPASSWORD=\"$DB_PASSWORD\" pg_dump \"${pg_dump_args[@]}\"; then\n        log_success \"Schema \u5907\u4efd\u5b8c\u6210: $backup_file\"\n\n        # \u538b\u7f29\u5907\u4efd\u6587\u4ef6\n        if [[ \"$COMPRESS_BACKUP\" == \"true\" ]]; then\n            log_info \"\u538b\u7f29\u5907\u4efd\u6587\u4ef6...\"\n            gzip \"$backup_file\"\n            backup_file=\"${backup_file}.gz\"\n            log_success \"\u538b\u7f29\u5b8c\u6210: $backup_file\"\n        fi\n\n        echo \"$backup_file\"\n    else\n        log_error \"Schema \u5907\u4efd\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u6570\u636e\u5907\u4efd\nperform_data_backup() {\n    log_info \"\u6267\u884c\u6570\u636e\u5907\u4efd...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/${DB_NAME}_data_${timestamp}.sql\"\n\n    local pg_dump_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$DB_NAME\"\n        --verbose\n        --data-only\n        --no-owner\n        --no-privileges\n        -f \"$backup_file\"\n    )\n\n    if PGPASSWORD=\"$DB_PASSWORD\" pg_dump \"${pg_dump_args[@]}\"; then\n        log_success \"\u6570\u636e\u5907\u4efd\u5b8c\u6210: $backup_file\"\n\n        # \u538b\u7f29\u5907\u4efd\u6587\u4ef6\n        if [[ \"$COMPRESS_BACKUP\" == \"true\" ]]; then\n            log_info \"\u538b\u7f29\u5907\u4efd\u6587\u4ef6...\"\n            gzip \"$backup_file\"\n            backup_file=\"${backup_file}.gz\"\n            log_success \"\u538b\u7f29\u5b8c\u6210: $backup_file\"\n        fi\n\n        echo \"$backup_file\"\n    else\n        log_error \"\u6570\u636e\u5907\u4efd\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u589e\u91cf\u5907\u4efd\uff08\u57fa\u4e8e WAL\uff09\nperform_incremental_backup() {\n    log_info \"\u6267\u884c\u589e\u91cf\u5907\u4efd...\"\n\n    # \u68c0\u67e5\u662f\u5426\u542f\u7528\u4e86 WAL \u5f52\u6863\n    local wal_archive_mode=$(PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" -t -c \"\n        SHOW wal_level;\n    \" | xargs)\n\n    if [[ \"$wal_archive_mode\" != \"replica\" &amp;&amp; \"$wal_archive_mode\" != \"logical\" ]]; then\n        log_warning \"WAL \u7ea7\u522b\u4e0d\u662f replica \u6216 logical\uff0c\u65e0\u6cd5\u6267\u884c\u589e\u91cf\u5907\u4efd\"\n        log_info \"\u5efa\u8bae\u5728 postgresql.conf \u4e2d\u8bbe\u7f6e: wal_level = replica\"\n        return 1\n    fi\n\n    # \u6267\u884c pg_basebackup\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_dir=\"$BACKUP_DIR/${DB_NAME}_incremental_${timestamp}\"\n\n    if PGPASSWORD=\"$DB_PASSWORD\" pg_basebackup \\\n        -h \"$DB_HOST\" \\\n        -p \"$DB_PORT\" \\\n        -U \"$DB_USER\" \\\n        -D \"$backup_dir\" \\\n        --verbose \\\n        --progress; then\n\n        log_success \"\u589e\u91cf\u5907\u4efd\u5b8c\u6210: $backup_dir\"\n        echo \"$backup_dir\"\n    else\n        log_error \"\u589e\u91cf\u5907\u4efd\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6\nverify_backup() {\n    local backup_file=$1\n    log_info \"\u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6: $backup_file\"\n\n    if [[ ! -f \"$backup_file\" ]]; then\n        log_error \"\u5907\u4efd\u6587\u4ef6\u4e0d\u5b58\u5728\"\n        return 1\n    fi\n\n    # \u68c0\u67e5\u6587\u4ef6\u5927\u5c0f\n    local file_size=$(du -h \"$backup_file\" | cut -f1)\n    log_info \"\u5907\u4efd\u6587\u4ef6\u5927\u5c0f: $file_size\"\n\n    # \u5982\u679c\u662f\u538b\u7f29\u6587\u4ef6\uff0c\u68c0\u67e5\u5b8c\u6574\u6027\n    if [[ \"$backup_file\" == *.gz ]]; then\n        if gzip -t \"$backup_file\"; then\n            log_success \"\u538b\u7f29\u6587\u4ef6\u5b8c\u6574\u6027\u9a8c\u8bc1\u901a\u8fc7\"\n        else\n            log_error \"\u538b\u7f29\u6587\u4ef6\u635f\u574f\"\n            return 1\n        fi\n    fi\n\n    log_success \"\u5907\u4efd\u6587\u4ef6\u9a8c\u8bc1\u901a\u8fc7\"\n}\n\n# \u6e05\u7406\u65e7\u5907\u4efd\ncleanup_old_backups() {\n    log_info \"\u6e05\u7406\u65e7\u5907\u4efd\u6587\u4ef6...\"\n\n    local deleted_count=0\n\n    # \u6e05\u7406 SQL \u5907\u4efd\u6587\u4ef6\n    if [[ -d \"$BACKUP_DIR\" ]]; then\n        deleted_count=$(find \"$BACKUP_DIR\" -name \"*.sql*\" -mtime +\"$BACKUP_RETENTION_DAYS\" | wc -l)\n        find \"$BACKUP_DIR\" -name \"*.sql*\" -mtime +\"$BACKUP_RETENTION_DAYS\" -delete\n    fi\n\n    # \u6e05\u7406\u589e\u91cf\u5907\u4efd\u76ee\u5f55\n    if [[ -d \"$BACKUP_DIR\" ]]; then\n        local incremental_deleted=$(find \"$BACKUP_DIR\" -name \"*_incremental_*\" -type d -mtime +\"$BACKUP_RETENTION_DAYS\" | wc -l)\n        find \"$BACKUP_DIR\" -name \"*_incremental_*\" -type d -mtime +\"$BACKUP_RETENTION_DAYS\" -exec rm -rf {} +\n        deleted_count=$((deleted_count + incremental_deleted))\n    fi\n\n    log_success \"\u6e05\u7406\u5b8c\u6210\uff0c\u5220\u9664\u4e86 $deleted_count \u4e2a\u65e7\u5907\u4efd\u6587\u4ef6\"\n}\n\n# \u751f\u6210\u5907\u4efd\u62a5\u544a\ngenerate_backup_report() {\n    local backup_file=$1\n    log_info \"\u751f\u6210\u5907\u4efd\u62a5\u544a...\"\n\n    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')\n    local report_file=\"$BACKUP_DIR/backup_report_$(date '+%Y%m%d').txt\"\n\n    cat &gt;&gt; \"$report_file\" &lt;&lt; EOF\n=== PostgreSQL \u5907\u4efd\u62a5\u544a ===\n\u5907\u4efd\u65f6\u95f4: $timestamp\n\u6570\u636e\u5e93: $DB_NAME\n\u4e3b\u673a: $DB_HOST:$DB_PORT\n\u5907\u4efd\u7c7b\u578b: $BACKUP_TYPE\n\u5907\u4efd\u6587\u4ef6: $backup_file\n\u6587\u4ef6\u5927\u5c0f: $(du -h \"$backup_file\" | cut -f1)\n\u538b\u7f29: $COMPRESS_BACKUP\n\nEOF\n\n    log_success \"\u5907\u4efd\u62a5\u544a\u5df2\u751f\u6210: $report_file\"\n}\n\n# \u4e3b\u51fd\u6570\nmain() {\n    log_info \"\u5f00\u59cb PostgreSQL \u5907\u4efd...\"\n\n    check_dependencies\n    test_connection\n    get_db_info\n    create_backup_dir\n\n    local backup_file=\"\"\n\n    case \"$BACKUP_TYPE\" in\n        \"full\")\n            backup_file=$(perform_full_backup)\n            ;;\n        \"schema\")\n            backup_file=$(perform_schema_backup)\n            ;;\n        \"data\")\n            backup_file=$(perform_data_backup)\n            ;;\n        \"incremental\")\n            backup_file=$(perform_incremental_backup)\n            ;;\n        *)\n            log_error \"\u4e0d\u652f\u6301\u7684\u5907\u4efd\u7c7b\u578b: $BACKUP_TYPE\"\n            log_info \"\u652f\u6301\u7684\u5907\u4efd\u7c7b\u578b: full, schema, data, incremental\"\n            exit 1\n            ;;\n    esac\n\n    # \u9a8c\u8bc1\u5907\u4efd\n    if [[ -n \"$backup_file\" ]]; then\n        verify_backup \"$backup_file\"\n        generate_backup_report \"$backup_file\"\n    fi\n\n    # \u6e05\u7406\u65e7\u5907\u4efd\n    cleanup_old_backups\n\n    log_success \"PostgreSQL \u5907\u4efd\u5b8c\u6210\uff01\"\n}\n\n# \u811a\u672c\u5165\u53e3\nif [[ \"${BASH_SOURCE[0]}\" == \"${0}\" ]]; then\n    main \"$@\"\nfi\n</code></pre>"},{"location":"devops/postgres-backup/#_3","title":"\ud83d\udd27 \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"devops/postgres-backup/#1","title":"1. \u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<pre><code># \u6570\u636e\u5e93\u914d\u7f6e\nexport DB_HOST=\"localhost\"\nexport DB_PORT=\"5432\"\nexport DB_NAME=\"my_database\"\nexport DB_USER=\"postgres\"\nexport DB_PASSWORD=\"password\"\n\n# \u5907\u4efd\u914d\u7f6e\nexport BACKUP_DIR=\"/backup/postgres\"\nexport BACKUP_RETENTION_DAYS=\"7\"\nexport COMPRESS_BACKUP=\"true\"\nexport BACKUP_TYPE=\"full\"  # full, schema, data, incremental\n</code></pre>"},{"location":"devops/postgres-backup/#2","title":"2. \u6267\u884c\u5907\u4efd","text":"<pre><code># \u5168\u91cf\u5907\u4efd\nexport BACKUP_TYPE=\"full\"\n./postgres-backup.sh\n\n# Schema \u5907\u4efd\nexport BACKUP_TYPE=\"schema\"\n./postgres-backup.sh\n\n# \u6570\u636e\u5907\u4efd\nexport BACKUP_TYPE=\"data\"\n./postgres-backup.sh\n\n# \u589e\u91cf\u5907\u4efd\nexport BACKUP_TYPE=\"incremental\"\n./postgres-backup.sh\n</code></pre>"},{"location":"devops/postgres-backup/#3","title":"3. \u5b9a\u65f6\u5907\u4efd","text":"<pre><code># \u6bcf\u5929\u51cc\u66682\u70b9\u6267\u884c\u5168\u91cf\u5907\u4efd\n0 2 * * * /path/to/postgres-backup.sh &gt;&gt; /var/log/postgres-backup.log 2&gt;&amp;1\n\n# \u6bcf\u5c0f\u65f6\u6267\u884c\u589e\u91cf\u5907\u4efd\n0 * * * * export BACKUP_TYPE=\"incremental\" &amp;&amp; /path/to/postgres-backup.sh &gt;&gt; /var/log/postgres-backup.log 2&gt;&amp;1\n</code></pre>"},{"location":"devops/postgres-backup/#_4","title":"\ud83d\udcca \u5907\u4efd\u7c7b\u578b\u8bf4\u660e","text":"\u5907\u4efd\u7c7b\u578b \u8bf4\u660e \u9002\u7528\u573a\u666f <code>full</code> \u5168\u91cf\u5907\u4efd\uff0c\u5305\u542b\u6240\u6709\u6570\u636e\u548c\u7ed3\u6784 \u5b8c\u6574\u5907\u4efd\uff0c\u707e\u96be\u6062\u590d <code>schema</code> \u4ec5\u5907\u4efd\u6570\u636e\u5e93\u7ed3\u6784 \u90e8\u7f72\u65b0\u73af\u5883\uff0c\u7ed3\u6784\u8fc1\u79fb <code>data</code> \u4ec5\u5907\u4efd\u6570\u636e\uff0c\u4e0d\u5305\u542b\u7ed3\u6784 \u6570\u636e\u8fc1\u79fb\uff0c\u6570\u636e\u6062\u590d <code>incremental</code> \u57fa\u4e8e WAL \u7684\u589e\u91cf\u5907\u4efd \u9891\u7e41\u5907\u4efd\uff0c\u6700\u5c0f\u5316\u6570\u636e\u4e22\u5931"},{"location":"devops/postgres-backup/#_5","title":"\ud83d\udcdd \u76d1\u63a7\u548c\u544a\u8b66","text":"<pre><code># \u68c0\u67e5\u5907\u4efd\u72b6\u6001\ngrep \"SUCCESS.*\u5907\u4efd\u5b8c\u6210\" /var/log/postgres-backup.log | tail -1\n\n# \u68c0\u67e5\u5907\u4efd\u6587\u4ef6\u5927\u5c0f\nls -lh /backup/postgres/\n\n# \u68c0\u67e5\u5907\u4efd\u6587\u4ef6\u6570\u91cf\nfind /backup/postgres/ -name \"*.sql*\" | wc -l\n</code></pre>"},{"location":"devops/postgres-restore/","title":"PostgreSQL \u6062\u590d\u811a\u672c","text":""},{"location":"devops/postgres-restore/#_1","title":"\ud83d\udccb \u6982\u8ff0","text":"<p>\u8fd9\u4e2a\u811a\u672c\u4e13\u95e8\u7528\u4e8e PostgreSQL \u6570\u636e\u5e93\u7684\u6062\u590d\u64cd\u4f5c\uff0c\u652f\u6301\u4ece\u4e0d\u540c\u7c7b\u578b\u7684\u5907\u4efd\u6587\u4ef6\u4e2d\u6062\u590d\u6570\u636e\u3002</p>"},{"location":"devops/postgres-restore/#_2","title":"\ud83d\ude80 \u6062\u590d\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n# PostgreSQL \u6062\u590d\u811a\u672c\nset -euo pipefail\n\n# \u989c\u8272\u5b9a\u4e49\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# \u65e5\u5fd7\u51fd\u6570\nlog_info() {\n    echo -e \"${BLUE}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_warning() {\n    echo -e \"${YELLOW}[WARNING]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\n# \u73af\u5883\u53d8\u91cf\u914d\u7f6e\nDB_HOST=\"${DB_HOST:-localhost}\"\nDB_PORT=\"${DB_PORT:-5432}\"\nDB_NAME=\"${DB_NAME:-postgres}\"\nDB_USER=\"${DB_USER:-postgres}\"\nDB_PASSWORD=\"${DB_PASSWORD:-}\"\n\nBACKUP_FILE=\"${BACKUP_FILE:-}\"\nBACKUP_DIR=\"${BACKUP_DIR:-/backup/postgres}\"\nRESTORE_TYPE=\"${RESTORE_TYPE:-full}\"  # full, schema, data\nDROP_EXISTING=\"${DROP_EXISTING:-false}\"\nVERIFY_RESTORE=\"${VERIFY_RESTORE:-true}\"\n\n# \u68c0\u67e5\u4f9d\u8d56\ncheck_dependencies() {\n    log_info \"\u68c0\u67e5\u4f9d\u8d56...\"\n\n    if ! command -v pg_restore &amp;&gt; /dev/null; then\n        log_error \"pg_restore \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if ! command -v psql &amp;&gt; /dev/null; then\n        log_error \"psql \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if ! command -v gunzip &amp;&gt; /dev/null; then\n        log_warning \"gunzip \u672a\u5b89\u88c5\uff0c\u53ef\u80fd\u65e0\u6cd5\u5904\u7406\u538b\u7f29\u6587\u4ef6\"\n    fi\n\n    log_success \"\u4f9d\u8d56\u68c0\u67e5\u5b8c\u6210\"\n}\n\n# \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5\ntest_connection() {\n    log_info \"\u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5...\"\n\n    if ! PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$DB_NAME\" -c \"SELECT 1;\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    log_success \"\u6570\u636e\u5e93\u8fde\u63a5\u6d4b\u8bd5\u901a\u8fc7\"\n}\n\n# \u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6\nvalidate_backup_file() {\n    log_info \"\u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6...\"\n\n    if [[ -z \"$BACKUP_FILE\" ]]; then\n        log_error \"\u672a\u6307\u5b9a\u5907\u4efd\u6587\u4ef6\"\n        log_info \"\u8bf7\u8bbe\u7f6e BACKUP_FILE \u73af\u5883\u53d8\u91cf\"\n        exit 1\n    fi\n\n    if [[ ! -f \"$BACKUP_FILE\" ]]; then\n        log_error \"\u5907\u4efd\u6587\u4ef6\u4e0d\u5b58\u5728: $BACKUP_FILE\"\n        exit 1\n    fi\n\n    # \u68c0\u67e5\u6587\u4ef6\u5927\u5c0f\n    local file_size=$(du -h \"$BACKUP_FILE\" | cut -f1)\n    log_info \"\u5907\u4efd\u6587\u4ef6\u5927\u5c0f: $file_size\"\n\n    # \u68c0\u67e5\u6587\u4ef6\u7c7b\u578b\n    if [[ \"$BACKUP_FILE\" == *.gz ]]; then\n        log_info \"\u68c0\u6d4b\u5230\u538b\u7f29\u6587\u4ef6\uff0c\u5c06\u81ea\u52a8\u89e3\u538b\"\n        if ! gzip -t \"$BACKUP_FILE\"; then\n            log_error \"\u538b\u7f29\u6587\u4ef6\u635f\u574f\"\n            exit 1\n        fi\n    fi\n\n    log_success \"\u5907\u4efd\u6587\u4ef6\u9a8c\u8bc1\u901a\u8fc7\"\n}\n\n# \u83b7\u53d6\u5907\u4efd\u6587\u4ef6\u4fe1\u606f\nget_backup_info() {\n    local backup_file=$1\n    log_info \"\u83b7\u53d6\u5907\u4efd\u6587\u4ef6\u4fe1\u606f...\"\n\n    if [[ \"$backup_file\" == *.gz ]]; then\n        # \u538b\u7f29\u6587\u4ef6\uff0c\u4f7f\u7528 gunzip -c \u67e5\u770b\u5185\u5bb9\n        local first_line=$(gunzip -c \"$backup_file\" | head -1)\n    else\n        local first_line=$(head -1 \"$backup_file\")\n    fi\n\n    if [[ \"$first_line\" == *\"-- PostgreSQL database dump\"* ]]; then\n        log_info \"\u5907\u4efd\u6587\u4ef6\u7c7b\u578b: PostgreSQL SQL \u8f6c\u50a8\"\n        echo \"sql\"\n    elif [[ \"$first_line\" == *\"PGDMP\"* ]]; then\n        log_info \"\u5907\u4efd\u6587\u4ef6\u7c7b\u578b: PostgreSQL \u81ea\u5b9a\u4e49\u683c\u5f0f\"\n        echo \"custom\"\n    else\n        log_warning \"\u672a\u77e5\u7684\u5907\u4efd\u6587\u4ef6\u683c\u5f0f\"\n        echo \"unknown\"\n    fi\n}\n\n# \u521b\u5efa\u4e34\u65f6\u6570\u636e\u5e93\uff08\u7528\u4e8e\u6d4b\u8bd5\u6062\u590d\uff09\ncreate_temp_database() {\n    local temp_db=\"temp_restore_$(date +%s)\"\n    log_info \"\u521b\u5efa\u4e34\u65f6\u6570\u636e\u5e93: $temp_db\"\n\n    if PGPASSWORD=\"$DB_PASSWORD\" createdb -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" \"$temp_db\"; then\n        log_success \"\u4e34\u65f6\u6570\u636e\u5e93\u521b\u5efa\u6210\u529f: $temp_db\"\n        echo \"$temp_db\"\n    else\n        log_error \"\u4e34\u65f6\u6570\u636e\u5e93\u521b\u5efa\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u5220\u9664\u4e34\u65f6\u6570\u636e\u5e93\ndrop_temp_database() {\n    local temp_db=$1\n    if [[ -n \"$temp_db\" ]]; then\n        log_info \"\u5220\u9664\u4e34\u65f6\u6570\u636e\u5e93: $temp_db\"\n        PGPASSWORD=\"$DB_PASSWORD\" dropdb -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" \"$temp_db\" || true\n    fi\n}\n\n# \u5168\u91cf\u6062\u590d\nperform_full_restore() {\n    local backup_file=$1\n    local target_db=$2\n    log_info \"\u6267\u884c\u5168\u91cf\u6062\u590d...\"\n\n    local restore_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$target_db\"\n        --verbose\n        --clean\n        --if-exists\n        --no-owner\n        --no-privileges\n    )\n\n    if [[ \"$backup_file\" == *.gz ]]; then\n        log_info \"\u89e3\u538b\u5e76\u6062\u590d\u538b\u7f29\u6587\u4ef6...\"\n        gunzip -c \"$backup_file\" | PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\"\n    else\n        PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\" \"$backup_file\"\n    fi\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"\u5168\u91cf\u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"\u5168\u91cf\u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# Schema \u6062\u590d\nperform_schema_restore() {\n    local backup_file=$1\n    local target_db=$2\n    log_info \"\u6267\u884c Schema \u6062\u590d...\"\n\n    local restore_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$target_db\"\n        --verbose\n        --schema-only\n        --clean\n        --if-exists\n        --no-owner\n        --no-privileges\n    )\n\n    if [[ \"$backup_file\" == *.gz ]]; then\n        log_info \"\u89e3\u538b\u5e76\u6062\u590d Schema...\"\n        gunzip -c \"$backup_file\" | PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\"\n    else\n        PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\" \"$backup_file\"\n    fi\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"Schema \u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"Schema \u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u6570\u636e\u6062\u590d\nperform_data_restore() {\n    local backup_file=$1\n    local target_db=$2\n    log_info \"\u6267\u884c\u6570\u636e\u6062\u590d...\"\n\n    local restore_args=(\n        -h \"$DB_HOST\"\n        -p \"$DB_PORT\"\n        -U \"$DB_USER\"\n        -d \"$target_db\"\n        --verbose\n        --data-only\n        --no-owner\n        --no-privileges\n    )\n\n    if [[ \"$backup_file\" == *.gz ]]; then\n        log_info \"\u89e3\u538b\u5e76\u6062\u590d\u6570\u636e...\"\n        gunzip -c \"$backup_file\" | PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\"\n    else\n        PGPASSWORD=\"$DB_PASSWORD\" pg_restore \"${restore_args[@]}\" \"$backup_file\"\n    fi\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"\u6570\u636e\u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"\u6570\u636e\u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# SQL \u683c\u5f0f\u6062\u590d\nperform_sql_restore() {\n    local backup_file=$1\n    local target_db=$2\n    log_info \"\u6267\u884c SQL \u683c\u5f0f\u6062\u590d...\"\n\n    if [[ \"$backup_file\" == *.gz ]]; then\n        log_info \"\u89e3\u538b\u5e76\u6267\u884c SQL \u6062\u590d...\"\n        gunzip -c \"$backup_file\" | PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$target_db\" --verbose\n    else\n        PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$target_db\" --verbose &lt; \"$backup_file\"\n    fi\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"SQL \u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"SQL \u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u9a8c\u8bc1\u6062\u590d\u7ed3\u679c\nverify_restore() {\n    local target_db=$1\n    log_info \"\u9a8c\u8bc1\u6062\u590d\u7ed3\u679c...\"\n\n    # \u68c0\u67e5\u8868\u6570\u91cf\n    local table_count=$(PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$target_db\" -t -c \"\n        SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';\n    \" | xargs)\n\n    if [[ \"$table_count\" -gt 0 ]]; then\n        log_success \"\u6062\u590d\u9a8c\u8bc1\u901a\u8fc7: $table_count \u4e2a\u8868\"\n    else\n        log_warning \"\u6062\u590d\u540e\u6ca1\u6709\u627e\u5230\u8868\"\n    fi\n\n    # \u68c0\u67e5\u6570\u636e\u5e93\u5927\u5c0f\n    local db_size=$(PGPASSWORD=\"$DB_PASSWORD\" psql -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$target_db\" -t -c \"\n        SELECT pg_size_pretty(pg_database_size('$target_db'));\n    \" | xargs)\n\n    log_info \"\u6062\u590d\u540e\u6570\u636e\u5e93\u5927\u5c0f: $db_size\"\n}\n\n# \u5907\u4efd\u73b0\u6709\u6570\u636e\u5e93\nbackup_existing_database() {\n    local db_name=$1\n    log_info \"\u5907\u4efd\u73b0\u6709\u6570\u636e\u5e93: $db_name\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/${db_name}_before_restore_${timestamp}.sql\"\n\n    if PGPASSWORD=\"$DB_PASSWORD\" pg_dump -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" -d \"$db_name\" --verbose &gt; \"$backup_file\"; then\n        log_success \"\u73b0\u6709\u6570\u636e\u5e93\u5907\u4efd\u5b8c\u6210: $backup_file\"\n    else\n        log_warning \"\u73b0\u6709\u6570\u636e\u5e93\u5907\u4efd\u5931\u8d25\"\n    fi\n}\n\n# \u4e3b\u51fd\u6570\nmain() {\n    log_info \"\u5f00\u59cb PostgreSQL \u6062\u590d...\"\n\n    check_dependencies\n    test_connection\n    validate_backup_file\n\n    local backup_type=$(get_backup_info \"$BACKUP_FILE\")\n    local temp_db=\"\"\n\n    # \u5982\u679c\u542f\u7528\u6d4b\u8bd5\u6a21\u5f0f\uff0c\u521b\u5efa\u4e34\u65f6\u6570\u636e\u5e93\n    if [[ \"${TEST_RESTORE:-false}\" == \"true\" ]]; then\n        temp_db=$(create_temp_database)\n        local target_db=\"$temp_db\"\n    else\n        local target_db=\"$DB_NAME\"\n\n        # \u5982\u679c\u542f\u7528\u5220\u9664\u73b0\u6709\u6570\u636e\u5e93\uff0c\u5148\u5907\u4efd\n        if [[ \"$DROP_EXISTING\" == \"true\" ]]; then\n            backup_existing_database \"$target_db\"\n\n            log_info \"\u5220\u9664\u73b0\u6709\u6570\u636e\u5e93: $target_db\"\n            PGPASSWORD=\"$DB_PASSWORD\" dropdb -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" \"$target_db\" || true\n\n            log_info \"\u521b\u5efa\u65b0\u6570\u636e\u5e93: $target_db\"\n            PGPASSWORD=\"$DB_PASSWORD\" createdb -h \"$DB_HOST\" -p \"$DB_PORT\" -U \"$DB_USER\" \"$target_db\"\n        fi\n    fi\n\n    # \u6839\u636e\u5907\u4efd\u7c7b\u578b\u548c\u6062\u590d\u7c7b\u578b\u6267\u884c\u6062\u590d\n    case \"$backup_type\" in\n        \"sql\")\n            perform_sql_restore \"$BACKUP_FILE\" \"$target_db\"\n            ;;\n        \"custom\")\n            case \"$RESTORE_TYPE\" in\n                \"full\")\n                    perform_full_restore \"$BACKUP_FILE\" \"$target_db\"\n                    ;;\n                \"schema\")\n                    perform_schema_restore \"$BACKUP_FILE\" \"$target_db\"\n                    ;;\n                \"data\")\n                    perform_data_restore \"$BACKUP_FILE\" \"$target_db\"\n                    ;;\n                *)\n                    log_error \"\u4e0d\u652f\u6301\u7684\u6062\u590d\u7c7b\u578b: $RESTORE_TYPE\"\n                    exit 1\n                    ;;\n            esac\n            ;;\n        *)\n            log_warning \"\u672a\u77e5\u5907\u4efd\u7c7b\u578b\uff0c\u5c1d\u8bd5 SQL \u6062\u590d\"\n            perform_sql_restore \"$BACKUP_FILE\" \"$target_db\"\n            ;;\n    esac\n\n    # \u9a8c\u8bc1\u6062\u590d\u7ed3\u679c\n    if [[ \"$VERIFY_RESTORE\" == \"true\" ]]; then\n        verify_restore \"$target_db\"\n    fi\n\n    # \u6e05\u7406\u4e34\u65f6\u6570\u636e\u5e93\n    if [[ -n \"$temp_db\" ]]; then\n        log_info \"\u6d4b\u8bd5\u6062\u590d\u5b8c\u6210\uff0c\u6e05\u7406\u4e34\u65f6\u6570\u636e\u5e93\"\n        drop_temp_database \"$temp_db\"\n    fi\n\n    log_success \"PostgreSQL \u6062\u590d\u5b8c\u6210\uff01\"\n}\n\n# \u811a\u672c\u5165\u53e3\nif [[ \"${BASH_SOURCE[0]}\" == \"${0}\" ]]; then\n    main \"$@\"\nfi\n</code></pre>"},{"location":"devops/postgres-restore/#_3","title":"\ud83d\udd27 \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"devops/postgres-restore/#1","title":"1. \u73af\u5883\u53d8\u91cf\u914d\u7f6e","text":"<pre><code># \u6570\u636e\u5e93\u914d\u7f6e\nexport DB_HOST=\"localhost\"\nexport DB_PORT=\"5432\"\nexport DB_NAME=\"my_database\"\nexport DB_USER=\"postgres\"\nexport DB_PASSWORD=\"password\"\n\n# \u6062\u590d\u914d\u7f6e\nexport BACKUP_FILE=\"/backup/postgres/my_database_full_20240101_120000.sql.gz\"\nexport RESTORE_TYPE=\"full\"  # full, schema, data\nexport DROP_EXISTING=\"false\"\nexport VERIFY_RESTORE=\"true\"\nexport TEST_RESTORE=\"false\"  # \u6d4b\u8bd5\u6a21\u5f0f\uff0c\u4f7f\u7528\u4e34\u65f6\u6570\u636e\u5e93\n</code></pre>"},{"location":"devops/postgres-restore/#2","title":"2. \u6267\u884c\u6062\u590d","text":"<pre><code># \u5168\u91cf\u6062\u590d\nexport RESTORE_TYPE=\"full\"\n./postgres-restore.sh\n\n# Schema \u6062\u590d\nexport RESTORE_TYPE=\"schema\"\n./postgres-restore.sh\n\n# \u6570\u636e\u6062\u590d\nexport RESTORE_TYPE=\"data\"\n./postgres-restore.sh\n\n# \u6d4b\u8bd5\u6062\u590d\uff08\u4f7f\u7528\u4e34\u65f6\u6570\u636e\u5e93\uff09\nexport TEST_RESTORE=\"true\"\n./postgres-restore.sh\n</code></pre>"},{"location":"devops/postgres-restore/#3","title":"3. \u5b89\u5168\u6062\u590d","text":"<pre><code># \u5148\u5907\u4efd\u73b0\u6709\u6570\u636e\u5e93\uff0c\u7136\u540e\u6062\u590d\nexport DROP_EXISTING=\"true\"\nexport BACKUP_FILE=\"/backup/postgres/production_backup.sql.gz\"\n./postgres-restore.sh\n</code></pre>"},{"location":"devops/postgres-restore/#_4","title":"\ud83d\udcca \u6062\u590d\u7c7b\u578b\u8bf4\u660e","text":"\u6062\u590d\u7c7b\u578b \u8bf4\u660e \u9002\u7528\u573a\u666f <code>full</code> \u5168\u91cf\u6062\u590d\uff0c\u5305\u542b\u6240\u6709\u6570\u636e\u548c\u7ed3\u6784 \u5b8c\u6574\u6062\u590d\uff0c\u707e\u96be\u6062\u590d <code>schema</code> \u4ec5\u6062\u590d\u6570\u636e\u5e93\u7ed3\u6784 \u7ed3\u6784\u8fc1\u79fb\uff0c\u90e8\u7f72\u65b0\u73af\u5883 <code>data</code> \u4ec5\u6062\u590d\u6570\u636e\uff0c\u4e0d\u5305\u542b\u7ed3\u6784 \u6570\u636e\u8fc1\u79fb\uff0c\u6570\u636e\u6062\u590d"},{"location":"devops/postgres-restore/#_5","title":"\ud83d\udd0d \u6545\u969c\u6392\u9664","text":""},{"location":"devops/postgres-restore/#_6","title":"\u5e38\u89c1\u95ee\u9898","text":"<ol> <li> <p>\u6743\u9650\u4e0d\u8db3 <pre><code># \u786e\u4fdd\u7528\u6237\u6709\u8db3\u591f\u6743\u9650\nGRANT ALL PRIVILEGES ON DATABASE my_database TO my_user;\n</code></pre></p> </li> <li> <p>\u6570\u636e\u5e93\u5df2\u5b58\u5728 <pre><code># \u5220\u9664\u73b0\u6709\u6570\u636e\u5e93\nexport DROP_EXISTING=\"true\"\n</code></pre></p> </li> <li> <p>\u5907\u4efd\u6587\u4ef6\u635f\u574f <pre><code># \u9a8c\u8bc1\u5907\u4efd\u6587\u4ef6\ngzip -t backup_file.sql.gz\n</code></pre></p> </li> </ol>"},{"location":"devops/postgres-restore/#_7","title":"\u6062\u590d\u9a8c\u8bc1","text":"<pre><code># \u68c0\u67e5\u6062\u590d\u540e\u7684\u8868\u6570\u91cf\npsql -d my_database -c \"SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';\"\n\n# \u68c0\u67e5\u6570\u636e\u5e93\u5927\u5c0f\npsql -d my_database -c \"SELECT pg_size_pretty(pg_database_size('my_database'));\"\n\n# \u68c0\u67e5\u7279\u5b9a\u8868\u7684\u6570\u636e\npsql -d my_database -c \"SELECT COUNT(*) FROM users;\"\n</code></pre>"},{"location":"devops/sync-neo4j/","title":"Neo4j \u6570\u636e\u540c\u6b65\u811a\u672c","text":""},{"location":"devops/sync-neo4j/#_1","title":"\ud83d\udccb \u6982\u8ff0","text":"<p>\u8fd9\u4e2a\u811a\u672c\u7528\u4e8e\u5728\u4e0d\u540c\u73af\u5883\u4e4b\u95f4\u540c\u6b65 Neo4j \u56fe\u6570\u636e\u5e93\u6570\u636e\u3002</p>"},{"location":"devops/sync-neo4j/#_2","title":"\ud83d\ude80 \u4e3b\u540c\u6b65\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n# Neo4j \u6570\u636e\u540c\u6b65\u811a\u672c\nset -euo pipefail\n\n# \u989c\u8272\u5b9a\u4e49\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# \u65e5\u5fd7\u51fd\u6570\nlog_info() {\n    echo -e \"${BLUE}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\n# \u73af\u5883\u53d8\u91cf\u914d\u7f6e\nSOURCE_HOST=\"${SOURCE_HOST:-localhost}\"\nSOURCE_PORT=\"${SOURCE_PORT:-7687}\"\nSOURCE_USER=\"${SOURCE_USER:-neo4j}\"\nSOURCE_PASSWORD=\"${SOURCE_PASSWORD:-password}\"\n\nTARGET_HOST=\"${TARGET_HOST:-localhost}\"\nTARGET_PORT=\"${TARGET_PORT:-7687}\"\nTARGET_USER=\"${TARGET_USER:-neo4j}\"\nTARGET_PASSWORD=\"${TARGET_PASSWORD:-password}\"\n\nBACKUP_DIR=\"${BACKUP_DIR:-/tmp/neo4j_backup}\"\n\n# \u68c0\u67e5\u4f9d\u8d56\ncheck_dependencies() {\n    log_info \"\u68c0\u67e5\u4f9d\u8d56...\"\n\n    if ! command -v cypher-shell &amp;&gt; /dev/null; then\n        log_error \"cypher-shell \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    log_success \"\u4f9d\u8d56\u68c0\u67e5\u5b8c\u6210\"\n}\n\n# \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5\ntest_connections() {\n    log_info \"\u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5...\"\n\n    # \u6d4b\u8bd5\u6e90\u6570\u636e\u5e93\u8fde\u63a5\n    if ! echo \"RETURN 1;\" | cypher-shell -a \"bolt://$SOURCE_HOST:$SOURCE_PORT\" -u \"$SOURCE_USER\" -p \"$SOURCE_PASSWORD\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u6e90\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    # \u6d4b\u8bd5\u76ee\u6807\u6570\u636e\u5e93\u8fde\u63a5\n    if ! echo \"RETURN 1;\" | cypher-shell -a \"bolt://$TARGET_HOST:$TARGET_PORT\" -u \"$TARGET_USER\" -p \"$TARGET_PASSWORD\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u76ee\u6807\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    log_success \"\u6570\u636e\u5e93\u8fde\u63a5\u6d4b\u8bd5\u901a\u8fc7\"\n}\n\n# \u6267\u884c\u5907\u4efd\nperform_backup() {\n    log_info \"\u5f00\u59cb\u5907\u4efd\u6e90\u6570\u636e\u5e93...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/neo4j_backup_${timestamp}.cypher\"\n\n    mkdir -p \"$BACKUP_DIR\"\n\n    # \u521b\u5efa\u5907\u4efd\u811a\u672c\n    cat &gt; \"$backup_file\" &lt;&lt; 'EOF'\n// Neo4j \u6570\u636e\u5907\u4efd\u811a\u672c\n// \u5bfc\u51fa\u6240\u6709\u8282\u70b9\nMATCH (n) RETURN n;\n\n// \u5bfc\u51fa\u6240\u6709\u5173\u7cfb\nMATCH ()-[r]-&gt;() RETURN r;\n\n// \u5bfc\u51fa\u7d22\u5f15\u4fe1\u606f\nSHOW INDEXES;\n\n// \u5bfc\u51fa\u7ea6\u675f\u4fe1\u606f\nSHOW CONSTRAINTS;\nEOF\n\n    log_success \"\u5907\u4efd\u811a\u672c\u521b\u5efa\u5b8c\u6210: $backup_file\"\n    echo \"$backup_file\"\n}\n\n# \u6267\u884c\u6062\u590d\nperform_restore() {\n    local backup_file=$1\n    log_info \"\u5f00\u59cb\u6062\u590d\u6570\u636e\u5230\u76ee\u6807\u6570\u636e\u5e93...\"\n\n    if [[ ! -f \"$backup_file\" ]]; then\n        log_error \"\u5907\u4efd\u6587\u4ef6\u4e0d\u5b58\u5728: $backup_file\"\n        exit 1\n    fi\n\n    # \u6e05\u7a7a\u76ee\u6807\u6570\u636e\u5e93\n    echo \"MATCH (n) DETACH DELETE n;\" | \\\n    cypher-shell -a \"bolt://$TARGET_HOST:$TARGET_PORT\" -u \"$TARGET_USER\" -p \"$TARGET_PASSWORD\"\n\n    # \u6267\u884c\u6062\u590d\u811a\u672c\n    cypher-shell -a \"bolt://$TARGET_HOST:$TARGET_PORT\" -u \"$TARGET_USER\" -p \"$TARGET_PASSWORD\" &lt; \"$backup_file\"\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"\u6570\u636e\u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"\u6570\u636e\u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u9a8c\u8bc1\u540c\u6b65\u7ed3\u679c\nverify_sync() {\n    log_info \"\u9a8c\u8bc1\u540c\u6b65\u7ed3\u679c...\"\n\n    # \u6bd4\u8f83\u8282\u70b9\u6570\u91cf\n    local source_nodes=$(echo \"MATCH (n) RETURN count(n) as count;\" | \\\n    cypher-shell -a \"bolt://$SOURCE_HOST:$SOURCE_PORT\" -u \"$SOURCE_USER\" -p \"$SOURCE_PASSWORD\" --format plain | \\\n    tail -1)\n\n    local target_nodes=$(echo \"MATCH (n) RETURN count(n) as count;\" | \\\n    cypher-shell -a \"bolt://$TARGET_HOST:$TARGET_PORT\" -u \"$TARGET_USER\" -p \"$TARGET_PASSWORD\" --format plain | \\\n    tail -1)\n\n    if [[ \"$source_nodes\" == \"$target_nodes\" ]]; then\n        log_success \"\u8282\u70b9\u6570\u91cf\u9a8c\u8bc1\u901a\u8fc7: $source_nodes \u4e2a\u8282\u70b9\"\n    else\n        log_error \"\u8282\u70b9\u6570\u91cf\u4e0d\u5339\u914d: \u6e90=$source_nodes, \u76ee\u6807=$target_nodes\"\n        exit 1\n    fi\n}\n\n# \u6e05\u7406\u65e7\u5907\u4efd\ncleanup_old_backups() {\n    log_info \"\u6e05\u7406\u65e7\u5907\u4efd\u6587\u4ef6...\"\n    find \"$BACKUP_DIR\" -name \"neo4j_backup_*\" -mtime +7 -delete\n    log_success \"\u65e7\u5907\u4efd\u6e05\u7406\u5b8c\u6210\"\n}\n\n# \u4e3b\u51fd\u6570\nmain() {\n    log_info \"\u5f00\u59cb Neo4j \u6570\u636e\u540c\u6b65...\"\n\n    check_dependencies\n    test_connections\n\n    # \u6267\u884c\u5907\u4efd\n    local backup_file=$(perform_backup)\n\n    # \u6267\u884c\u6062\u590d\n    perform_restore \"$backup_file\"\n\n    # \u9a8c\u8bc1\u540c\u6b65\n    verify_sync\n\n    # \u6e05\u7406\u65e7\u5907\u4efd\n    cleanup_old_backups\n\n    log_success \"Neo4j \u6570\u636e\u540c\u6b65\u5b8c\u6210\uff01\"\n}\n\n# \u811a\u672c\u5165\u53e3\nif [[ \"${BASH_SOURCE[0]}\" == \"${0}\" ]]; then\n    main \"$@\"\nfi\n</code></pre>"},{"location":"devops/sync-neo4j/#_3","title":"\ud83d\udd27 \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"devops/sync-neo4j/#1","title":"1. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf","text":"<pre><code># \u6e90\u6570\u636e\u5e93\u914d\u7f6e\nexport SOURCE_HOST=\"source-neo4j.example.com\"\nexport SOURCE_PORT=\"7687\"\nexport SOURCE_USER=\"neo4j\"\nexport SOURCE_PASSWORD=\"source_password\"\n\n# \u76ee\u6807\u6570\u636e\u5e93\u914d\u7f6e\nexport TARGET_HOST=\"target-neo4j.example.com\"\nexport TARGET_PORT=\"7687\"\nexport TARGET_USER=\"neo4j\"\nexport TARGET_PASSWORD=\"target_password\"\n</code></pre>"},{"location":"devops/sync-neo4j/#2","title":"2. \u6267\u884c\u540c\u6b65","text":"<pre><code>chmod +x sync-neo4j.sh\n./sync-neo4j.sh\n</code></pre>"},{"location":"devops/sync-neo4j/#3","title":"3. \u5b9a\u65f6\u540c\u6b65","text":"<pre><code># \u6bcf\u5929\u51cc\u66683\u70b9\u6267\u884c\n0 3 * * * /path/to/sync-neo4j.sh &gt;&gt; /var/log/neo4j-sync.log 2&gt;&amp;1\n</code></pre>"},{"location":"devops/sync-neo4j/#_4","title":"\ud83d\udcca \u76d1\u63a7","text":"<pre><code># \u67e5\u770b\u540c\u6b65\u65e5\u5fd7\ntail -f /var/log/neo4j-sync.log\n\n# \u68c0\u67e5\u540c\u6b65\u72b6\u6001\ngrep \"SUCCESS.*\u540c\u6b65\u5b8c\u6210\" /var/log/neo4j-sync.log | tail -1\n\n# \u68c0\u67e5\u6570\u636e\u5e93\u8fde\u63a5\ncypher-shell -a \"bolt://localhost:7687\" -u \"neo4j\" -p \"password\" -c \"RETURN 1;\"\n</code></pre>"},{"location":"devops/sync-postgres/","title":"PostgreSQL \u6570\u636e\u540c\u6b65\u811a\u672c","text":""},{"location":"devops/sync-postgres/#_1","title":"\ud83d\udccb \u6982\u8ff0","text":"<p>\u8fd9\u4e2a\u811a\u672c\u7528\u4e8e\u5728\u4e0d\u540c\u73af\u5883\u4e4b\u95f4\u540c\u6b65 PostgreSQL \u6570\u636e\u5e93\u6570\u636e\u3002</p>"},{"location":"devops/sync-postgres/#_2","title":"\ud83d\ude80 \u4e3b\u540c\u6b65\u811a\u672c","text":"<pre><code>#!/bin/bash\n\n# PostgreSQL \u6570\u636e\u540c\u6b65\u811a\u672c\nset -euo pipefail\n\n# \u989c\u8272\u5b9a\u4e49\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# \u65e5\u5fd7\u51fd\u6570\nlog_info() {\n    echo -e \"${BLUE}[INFO]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_success() {\n    echo -e \"${GREEN}[SUCCESS]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\nlog_error() {\n    echo -e \"${RED}[ERROR]${NC} $(date '+%Y-%m-%d %H:%M:%S') - $1\"\n}\n\n# \u73af\u5883\u53d8\u91cf\u914d\u7f6e\nSOURCE_HOST=\"${SOURCE_HOST:-localhost}\"\nSOURCE_PORT=\"${SOURCE_PORT:-5432}\"\nSOURCE_DB=\"${SOURCE_DB:-source_db}\"\nSOURCE_USER=\"${SOURCE_USER:-postgres}\"\nSOURCE_PASSWORD=\"${SOURCE_PASSWORD:-}\"\n\nTARGET_HOST=\"${TARGET_HOST:-localhost}\"\nTARGET_PORT=\"${TARGET_PORT:-5432}\"\nTARGET_DB=\"${TARGET_DB:-target_db}\"\nTARGET_USER=\"${TARGET_USER:-postgres}\"\nTARGET_PASSWORD=\"${TARGET_PASSWORD:-}\"\n\nBACKUP_DIR=\"${BACKUP_DIR:-/tmp/postgres_backup}\"\nLOG_FILE=\"${LOG_FILE:-/var/log/postgres-sync.log}\"\n\n# \u68c0\u67e5\u4f9d\u8d56\ncheck_dependencies() {\n    log_info \"\u68c0\u67e5\u4f9d\u8d56...\"\n\n    if ! command -v pg_dump &amp;&gt; /dev/null; then\n        log_error \"pg_dump \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    if ! command -v psql &amp;&gt; /dev/null; then\n        log_error \"psql \u672a\u5b89\u88c5\"\n        exit 1\n    fi\n\n    log_success \"\u4f9d\u8d56\u68c0\u67e5\u5b8c\u6210\"\n}\n\n# \u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5\ntest_connections() {\n    log_info \"\u6d4b\u8bd5\u6570\u636e\u5e93\u8fde\u63a5...\"\n\n    # \u6d4b\u8bd5\u6e90\u6570\u636e\u5e93\u8fde\u63a5\n    if ! PGPASSWORD=\"$SOURCE_PASSWORD\" psql -h \"$SOURCE_HOST\" -p \"$SOURCE_PORT\" -U \"$SOURCE_USER\" -d \"$SOURCE_DB\" -c \"SELECT 1;\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u6e90\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    # \u6d4b\u8bd5\u76ee\u6807\u6570\u636e\u5e93\u8fde\u63a5\n    if ! PGPASSWORD=\"$TARGET_PASSWORD\" psql -h \"$TARGET_HOST\" -p \"$TARGET_PORT\" -U \"$TARGET_USER\" -d \"$TARGET_DB\" -c \"SELECT 1;\" &amp;&gt; /dev/null; then\n        log_error \"\u65e0\u6cd5\u8fde\u63a5\u5230\u76ee\u6807\u6570\u636e\u5e93\"\n        exit 1\n    fi\n\n    log_success \"\u6570\u636e\u5e93\u8fde\u63a5\u6d4b\u8bd5\u901a\u8fc7\"\n}\n\n# \u6267\u884c\u5907\u4efd\nperform_backup() {\n    log_info \"\u5f00\u59cb\u5907\u4efd\u6e90\u6570\u636e\u5e93...\"\n\n    local timestamp=$(date '+%Y%m%d_%H%M%S')\n    local backup_file=\"$BACKUP_DIR/${SOURCE_DB}_${timestamp}.sql\"\n\n    mkdir -p \"$BACKUP_DIR\"\n\n    # \u6267\u884c\u5907\u4efd\n    if PGPASSWORD=\"$SOURCE_PASSWORD\" pg_dump \\\n        -h \"$SOURCE_HOST\" \\\n        -p \"$SOURCE_PORT\" \\\n        -U \"$SOURCE_USER\" \\\n        -d \"$SOURCE_DB\" \\\n        --verbose \\\n        --clean \\\n        --if-exists \\\n        --create \\\n        --no-owner \\\n        --no-privileges \\\n        &gt; \"$backup_file\"; then\n\n        log_success \"\u5907\u4efd\u5b8c\u6210: $backup_file\"\n        echo \"$backup_file\"\n    else\n        log_error \"\u5907\u4efd\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u6267\u884c\u6062\u590d\nperform_restore() {\n    local backup_file=$1\n    log_info \"\u5f00\u59cb\u6062\u590d\u6570\u636e\u5230\u76ee\u6807\u6570\u636e\u5e93...\"\n\n    if [[ ! -f \"$backup_file\" ]]; then\n        log_error \"\u5907\u4efd\u6587\u4ef6\u4e0d\u5b58\u5728: $backup_file\"\n        exit 1\n    fi\n\n    PGPASSWORD=\"$TARGET_PASSWORD\" psql \\\n        -h \"$TARGET_HOST\" \\\n        -p \"$TARGET_PORT\" \\\n        -U \"$TARGET_USER\" \\\n        -d \"$TARGET_DB\" \\\n        --verbose \\\n        &lt; \"$backup_file\"\n\n    if [[ $? -eq 0 ]]; then\n        log_success \"\u6570\u636e\u6062\u590d\u5b8c\u6210\"\n    else\n        log_error \"\u6570\u636e\u6062\u590d\u5931\u8d25\"\n        exit 1\n    fi\n}\n\n# \u9a8c\u8bc1\u540c\u6b65\u7ed3\u679c\nverify_sync() {\n    log_info \"\u9a8c\u8bc1\u540c\u6b65\u7ed3\u679c...\"\n\n    # \u6bd4\u8f83\u8868\u6570\u91cf\n    local source_tables=$(PGPASSWORD=\"$SOURCE_PASSWORD\" psql -h \"$SOURCE_HOST\" -p \"$SOURCE_PORT\" -U \"$SOURCE_USER\" -d \"$SOURCE_DB\" -t -c \"\n        SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';\n    \" | xargs)\n\n    local target_tables=$(PGPASSWORD=\"$TARGET_PASSWORD\" psql -h \"$TARGET_HOST\" -p \"$TARGET_PORT\" -U \"$TARGET_USER\" -d \"$TARGET_DB\" -t -c \"\n        SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';\n    \" | xargs)\n\n    if [[ \"$source_tables\" == \"$target_tables\" ]]; then\n        log_success \"\u8868\u6570\u91cf\u9a8c\u8bc1\u901a\u8fc7: $source_tables \u4e2a\u8868\"\n    else\n        log_error \"\u8868\u6570\u91cf\u4e0d\u5339\u914d: \u6e90=$source_tables, \u76ee\u6807=$target_tables\"\n        exit 1\n    fi\n}\n\n# \u6e05\u7406\u65e7\u5907\u4efd\ncleanup_old_backups() {\n    log_info \"\u6e05\u7406\u65e7\u5907\u4efd\u6587\u4ef6...\"\n    find \"$BACKUP_DIR\" -name \"*.sql\" -mtime +7 -delete\n    log_success \"\u65e7\u5907\u4efd\u6e05\u7406\u5b8c\u6210\"\n}\n\n# \u4e3b\u51fd\u6570\nmain() {\n    log_info \"\u5f00\u59cb PostgreSQL \u6570\u636e\u540c\u6b65...\"\n\n    check_dependencies\n    test_connections\n\n    # \u6267\u884c\u5907\u4efd\n    local backup_file=$(perform_backup)\n\n    # \u6267\u884c\u6062\u590d\n    perform_restore \"$backup_file\"\n\n    # \u9a8c\u8bc1\u540c\u6b65\n    verify_sync\n\n    # \u6e05\u7406\u65e7\u5907\u4efd\n    cleanup_old_backups\n\n    log_success \"PostgreSQL \u6570\u636e\u540c\u6b65\u5b8c\u6210\uff01\"\n}\n\n# \u811a\u672c\u5165\u53e3\nif [[ \"${BASH_SOURCE[0]}\" == \"${0}\" ]]; then\n    main \"$@\"\nfi\n</code></pre>"},{"location":"devops/sync-postgres/#_3","title":"\ud83d\udd27 \u4f7f\u7528\u65b9\u6cd5","text":""},{"location":"devops/sync-postgres/#1","title":"1. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf","text":"<pre><code># \u6e90\u6570\u636e\u5e93\u914d\u7f6e\nexport SOURCE_HOST=\"source-db.example.com\"\nexport SOURCE_PORT=\"5432\"\nexport SOURCE_DB=\"source_database\"\nexport SOURCE_USER=\"source_user\"\nexport SOURCE_PASSWORD=\"source_password\"\n\n# \u76ee\u6807\u6570\u636e\u5e93\u914d\u7f6e\nexport TARGET_HOST=\"target-db.example.com\"\nexport TARGET_PORT=\"5432\"\nexport TARGET_DB=\"target_database\"\nexport TARGET_USER=\"target_user\"\nexport TARGET_PASSWORD=\"target_password\"\n</code></pre>"},{"location":"devops/sync-postgres/#2","title":"2. \u6267\u884c\u540c\u6b65","text":"<pre><code>chmod +x sync-postgres.sh\n./sync-postgres.sh\n</code></pre>"},{"location":"devops/sync-postgres/#3","title":"3. \u5b9a\u65f6\u540c\u6b65","text":"<pre><code># \u6bcf\u5929\u51cc\u66682\u70b9\u6267\u884c\n0 2 * * * /path/to/sync-postgres.sh &gt;&gt; /var/log/postgres-sync.log 2&gt;&amp;1\n</code></pre>"},{"location":"devops/sync-postgres/#_4","title":"\ud83d\udcca \u76d1\u63a7","text":"<pre><code># \u67e5\u770b\u540c\u6b65\u65e5\u5fd7\ntail -f /var/log/postgres-sync.log\n\n# \u68c0\u67e5\u540c\u6b65\u72b6\u6001\ngrep \"SUCCESS.*\u540c\u6b65\u5b8c\u6210\" /var/log/postgres-sync.log | tail -1\n</code></pre>"},{"location":"knowledge-base/","title":"\u77e5\u8bc6\u5e93","text":"<p>\u8fd9\u91cc\u662f\u6211\u7684\u77e5\u8bc6\u5e93\uff0c\u6211\u4f1a\u5728\u8fd9\u91cc\u8bb0\u5f55\u5404\u79cd\u5e38\u7528\u7684\u547d\u4ee4\u548c\u6280\u5de7\uff0c\u65b9\u4fbf\u4ee5\u540e\u67e5\u9605\u548c\u53c2\u8003\u3002</p>"},{"location":"knowledge-base/#_2","title":"\ud83d\udccb \u901f\u67e5\u8868","text":"<ul> <li>\u5e38\u7528\u547d\u4ee4\u901f\u67e5\u8868</li> </ul>"},{"location":"knowledge-base/#linux","title":"\ud83d\udc27 Linux","text":"<ul> <li>Linux \u547d\u4ee4</li> </ul>"},{"location":"knowledge-base/#git","title":"\ud83d\udd27 Git","text":"<ul> <li>Git \u547d\u4ee4</li> </ul>"},{"location":"knowledge-base/#nodejs","title":"\ud83d\udce6 Node.js","text":"<ul> <li>Node.js \u547d\u4ee4</li> </ul>"},{"location":"knowledge-base/#docker","title":"\ud83d\udc33 Docker","text":"<ul> <li>\u5bb9\u5668\u7ba1\u7406</li> <li>\u955c\u50cf\u64cd\u4f5c</li> <li>\u6742\u9879\u6280\u5de7</li> </ul>"},{"location":"knowledge-base/#mysql","title":"\ud83d\uddc4\ufe0f MySQL","text":"<ul> <li>WSL \u73af\u5883\u5b89\u88c5</li> <li>MySQL \u547d\u4ee4</li> </ul>"},{"location":"knowledge-base/#python","title":"\ud83d\udc0d Python","text":"<ul> <li>Python \u547d\u4ee4</li> </ul>"},{"location":"knowledge-base/#sqlalchemy","title":"\ud83d\udd0c SQLAlchemy","text":"<ul> <li>SQLAlchemy \u57fa\u7840</li> <li>Alembic \u8fc1\u79fb</li> </ul>"},{"location":"knowledge-base/#_3","title":"\ud83d\udca1 \u4f7f\u7528\u8bf4\u660e","text":"<p>\u8fd9\u4e2a\u77e5\u8bc6\u5e93\u5305\u542b\u4e86\u6211\u5728\u65e5\u5e38\u5f00\u53d1\u4e2d\u5e38\u7528\u7684\u547d\u4ee4\u548c\u6280\u5de7\u3002\u6bcf\u4e2a\u6587\u6863\u90fd\u7ecf\u8fc7\u6574\u7406\u548c\u5206\u7c7b\uff0c\u65b9\u4fbf\u5feb\u901f\u67e5\u627e\u548c\u4f7f\u7528\u3002</p>"},{"location":"knowledge-base/#_4","title":"\u5982\u4f55\u8d21\u732e","text":"<p>\u5982\u679c\u4f60\u6709\u4efb\u4f55\u5efa\u8bae\u6216\u53d1\u73b0\u9519\u8bef\uff0c\u6b22\u8fce\u5728 GitHub \u4e0a\u521b\u5efa Issue \u6216\u63d0\u4ea4 Pull Request\u3002</p>"},{"location":"knowledge-base/#_5","title":"\u652f\u6301","text":"<p>\u5982\u679c\u4f60\u6709\u4efb\u4f55\u95ee\u9898\u6216\u5efa\u8bae\uff0c\u8bf7\u5728 GitHub \u4ed3\u5e93\u7684 Issue \u9875\u9762 \u521b\u5efa Issue\u3002</p>"},{"location":"knowledge-base/cheat_sheet/","title":"Cheat Sheet Collection","text":""},{"location":"knowledge-base/cheat_sheet/#toc","title":"TOC","text":"<p>datacamp cheat sheets</p>"},{"location":"knowledge-base/cheat_sheet/#mysql","title":"MYSQL","text":"<p>https://devhints.io/mysql</p> <p>https://media.datacamp.com/legacy/image/upload/v1698070184/Marketing/Blog/MySQL_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#postgresql","title":"POSTGRESQL","text":"<p>https://media.datacamp.com/legacy/image/upload/v1700745477/Marketing/Blog/PostgreSQL_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#sql-server","title":"SQL SERVER","text":"<p>https://media.datacamp.com/legacy/image/upload/v1713890725/Marketing/Blog/SQL_Window_Functions_1_1.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#python","title":"PYTHON","text":"<p>https://courses.cs.washington.edu/courses/cse163/22wi/resources/python-cheat-sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1694526244/Marketing/Blog/Python_Basics_Cheat_Sheet-updated.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676302316/Marketing/Blog/Python_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#git","title":"GIT","text":"<p>https://training.github.com/downloads/github-git-cheat-sheet.pdf</p> <p>https://liaoxuefeng.com/books/git/conclusion/git-cheat-sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1656573882/Marketing/Blog/git_cheat_sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#pandas","title":"PANDAS","text":"<p>https://geektutu.com/post/pandas-cheat-sheet-zh-cn/Pandas_Cheat_Sheet_zh_CN.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676302204/Marketing/Blog/Pandas_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676302827/Marketing/Blog/Data_Wrangling_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#numpy","title":"NUMPY","text":"<p>https://media.geeksforgeeks.org/wp-content/uploads/20240104182515/NumPy-Cheat-Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676302459/Marketing/Blog/Numpy_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#pytorch","title":"PYTORCH","text":"<p>https://media.datacamp.com/legacy/image/upload/v1695985637/Marketing/Blog/Deep_Learning_with_PyTorch_1.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#bash","title":"BASH","text":"<p>https://media.datacamp.com/legacy/image/upload/v1700047731/Marketing/Blog/Bash_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#markdown","title":"MARKDOWN","text":"<p>https://media.datacamp.com/legacy/image/upload/v1697797990/Marketing/Blog/Markdown_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#conda","title":"CONDA","text":"<p>https://media.datacamp.com/legacy/image/upload/v1681474450/Marketing/Blog/Conda_Cheat_Sheet_1.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#docker","title":"DOCKER","text":"<p>https://media.datacamp.com/legacy/image/upload/v1691588932/Marketing/Blog/Docker_for_Data_Science_Cheat_Sheet_2.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#math","title":"MATH","text":"<p>https://media.datacamp.com/legacy/image/upload/v1680264475/Marketing/Blog/Probability_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676303474/Marketing/Blog/SciPy_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1662111933/Marketing/Blog/Descriptive_Statistics_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#data","title":"DATA","text":"<p>https://media.datacamp.com/legacy/image/upload/v1676302004/Marketing/Blog/Importing_Data_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676303379/Marketing/Blog/PySpark_RDD_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#data-governance","title":"DATA GOVERNANCE","text":"<p>https://media.datacamp.com/legacy/image/upload/v1674823832/Marketing/Blog/Data_Governance_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#data-visualization","title":"DATA VISUALIZATION","text":"<p>https://s3.amazonaws.com/assets.datacamp.com/email/other/Data+Visualizations+-+DataCamp.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1712136349/Marketing/Blog/Matplotlib_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1668605954/Marketing/Blog/Plotly_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#machine-learning","title":"MACHINE LEARNING","text":"<p>https://media.datacamp.com/legacy/image/upload/v1669897463/Marketing/Blog/Supervised_Machine_Learning_Models.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1669897283/Marketing/Blog/Unsupervised_Machine_Learning_Models.pdf</p> <p>https://assets.datacamp.com/email/other/Cheat+Sheet_DS+For+Business+Leaders.pdf</p> <p>https://s3.amazonaws.com/assets.datacamp.com/email/other/ML+Cheat+Sheet_2.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1676302389/Marketing/Blog/Scikit-Learn_Cheat_Sheet.pdf</p> <p>https://media.datacamp.com/legacy/image/upload/v1660903348/Keras_Cheat_Sheet_gssmi8.pdf</p>"},{"location":"knowledge-base/cheat_sheet/#regular-expression","title":"REGULAR EXPRESSION","text":"<p>https://media.datacamp.com/legacy/image/upload/v1665049611/Marketing/Blog/Regular_Expressions_Cheat_Sheet.pdf</p>"},{"location":"knowledge-base/docker_container/","title":"docker container","text":""},{"location":"knowledge-base/docker_container/#commands","title":"commands","text":""},{"location":"knowledge-base/docker_container/#view-all-containers","title":"view all containers","text":"<pre><code># for all running contianers\ndocker ps\n\n# for all containers\ndocker ps -a\n</code></pre>"},{"location":"knowledge-base/docker_container/#remove-one-container","title":"remove one container","text":"<pre><code>docker rm container_name\n</code></pre>"},{"location":"knowledge-base/docker_container/#remove-all-containers","title":"remove all containers","text":"<pre><code>docker rm $(docker ps -aq)\n</code></pre>"},{"location":"knowledge-base/docker_container/#remove-all-containers_1","title":"remove all containers","text":"<pre><code>docker container prune\n</code></pre>"},{"location":"knowledge-base/docker_container/#stop-one-container","title":"stop one container","text":"<pre><code>docker stop container_name\n</code></pre>"},{"location":"knowledge-base/docker_container/#stop-all-containers","title":"stop all containers","text":"<pre><code>docker stop $(docker ps -aq)\n</code></pre>"},{"location":"knowledge-base/docker_container/#stop-all-containers-and-remove-them","title":"stop all containers and remove them","text":"<pre><code>docker stop $(docker ps -aq) &amp; docker rm $(docker ps -aq)\n</code></pre>"},{"location":"knowledge-base/docker_container/#start-one-container","title":"start one container","text":"<pre><code># for stopped container\ndocker start container_name\n\n# for running container\ndocker restart container_name\n</code></pre>"},{"location":"knowledge-base/docker_container/#enter-one-running-container","title":"enter one running container","text":"<pre><code># for iterative runing container\ndocker attach container_name\n\n# for all container\ndocker exec -it container_name /bin/bash\n</code></pre>"},{"location":"knowledge-base/docker_container/#export-and-import-container","title":"export and import container","text":"<pre><code># export\n# https://www.cnblogs.com/yanling-coder/p/11715534.html\ndocker export b91d9ad83efa &gt; tomcat80824.tar\n\n# import\ndocker import tomcat80824.tar\ndocker tag 880f tomcat80824:1.0\n</code></pre>"},{"location":"knowledge-base/docker_image/","title":"docker image","text":""},{"location":"knowledge-base/docker_image/#commands","title":"commands","text":""},{"location":"knowledge-base/docker_image/#view-all-images","title":"view all images","text":"<pre><code>docker images\n</code></pre>"},{"location":"knowledge-base/docker_image/#remove-one-image","title":"remove one image","text":"<pre><code>docker rmi image_name\n</code></pre>"},{"location":"knowledge-base/docker_image/#remove-all-images","title":"remove all images","text":"<pre><code>docker rmi $(docker images -aq)\n</code></pre>"},{"location":"knowledge-base/docker_image/#build-one-image","title":"build one image","text":"<pre><code>docker build -t image_name .\n</code></pre>"},{"location":"knowledge-base/docker_image/#remove-all-unused-image","title":"remove all unused image","text":"<pre><code>docker image prune -a\n\ndocker system df\n\nhttps://www.cnblogs.com/zjdxr-up/p/15769110.html\n</code></pre>"},{"location":"knowledge-base/docker_misc/","title":"docker","text":""},{"location":"knowledge-base/docker_misc/#mirror","title":"mirror","text":"<pre><code>Docker mirror:\nubuntu@mlops:~/dify-1.0.1/docker$ cat /etc/docker/daemon.json\n{\n  \"registry-mirrors\": [\n    \"https://docker.zhai.cm\",\n    \"https://a.ussh.net\",\n    \"https://hub.littlediary.cn\",\n    \"https://hub.rat.dev\",\n    \"https://atomhub.openatom.cn\",\n    \"https://docker.m.daocloud.io\",\n    \"https://docker.1ms.run\",\n    \"https://dytt.online\",\n    \"https://func.ink\",\n    \"https://lispy.org\",\n    \"https://docker.xiaogenban1993.com\",\n    \"https://docker.mybacc.com\",\n    \"https://docker.yomansunter.com\",\n    \"https://dockerhub.websoft9.com\"\n  ]\n}\n</code></pre>"},{"location":"knowledge-base/docker_misc/#commands","title":"commands","text":""},{"location":"knowledge-base/docker_misc/#check-disk-of-contianer","title":"check disk of contianer","text":"<pre><code>for i in $(docker ps -q ); do \n  echo \"ContainerID: $i\"; \n  ls -alh $(docker inspect $i | grep LogPath|awk -F \"\\\"\" '{print $4}');\ndone;\n</code></pre>"},{"location":"knowledge-base/docker_misc/#find-the-most-sized-container","title":"find the most sized container","text":"<pre><code>cd /var/lib/docker/containers\ndu -a --max-depth=1 | sort -nr | head -5\n</code></pre>"},{"location":"knowledge-base/docker_misc/#check-and-clean-disk-of-contianer","title":"check and clean disk of contianer","text":"<pre><code>docker inspect --format='{{.LogPath}}' my-app\n sudo sh -c 'echo \"\" &gt; $(docker inspect --format=\"{{.LogPath}}\" my-app)'\n</code></pre>"},{"location":"knowledge-base/git_command/","title":"git command","text":"<ul> <li>Gitflow</li> <li>git-flow cheatsheet</li> </ul>"},{"location":"knowledge-base/git_command/#commands","title":"commands","text":""},{"location":"knowledge-base/git_command/#get-head-commit-id","title":"get head commit id","text":"<pre><code>git rev-parse HEAD\n</code></pre>"},{"location":"knowledge-base/git_command/#view-remote-repo","title":"view remote repo","text":"<pre><code>git remote -v\n\ngit remote set-url origin git@github.com:fanqingsong/vanna-flask.git\ngit remote set-url --push origin git@github.com:fanqingsong/vanna-flask.git\n\ngit remote show origin\n\ngit branch -r\n</code></pre>"},{"location":"knowledge-base/git_command/#local-branches","title":"local branches","text":"<pre><code>git branch\n\ngit checkout -b xxx\n</code></pre>"},{"location":"knowledge-base/git_command/#alias","title":"alias","text":"<pre><code>git config --global alias.st status\ngit config --global alias.ci commit\ngit config --global alias.co checkout\n\n\nexample:\ngit config --global alias.unstage 'reset HEAD'\ngit unstage test.py\ngit reset HEAD test.py\n</code></pre>"},{"location":"knowledge-base/git_command/#add-tag","title":"add tag","text":"<pre><code>git push v1.0\n</code></pre>"},{"location":"knowledge-base/git_command/#push-tag","title":"push tag","text":"<pre><code>git push origin --tags\ngit push origin tagname\n</code></pre>"},{"location":"knowledge-base/git_command/#push-to-origin","title":"push to origin","text":"<pre><code>git push origin master:refs/for/master\n\ngit push origin HEAD:refs/drafts/master\n\ngit push origin master:refs/heads/master\n</code></pre>"},{"location":"knowledge-base/git_command/#git-push-review","title":"git push review","text":"<pre><code>git remote add review https://xxxx\ngit config remote.review.pushurl https://xxx\ngit config remote.review.push 'HEAD:refs/drafts/master'\n</code></pre>"},{"location":"knowledge-base/git_command/#push-head-to-origin-master-or-dev","title":"push head to origin master or dev","text":"<pre><code>git push origin master\ngit push origin dev\n</code></pre>"},{"location":"knowledge-base/git_command/#drop-all-your-work","title":"drop all your work","text":"<pre><code>git reset --hard origin/master\n\ngit reset --soft origin/master\n</code></pre>"},{"location":"knowledge-base/git_command/#git-add-all-but-exclude-some-one-file","title":"git add all but exclude some one file","text":"<pre><code>git add -u\ngit reset -- static/js/dashboard.js\n</code></pre>"},{"location":"knowledge-base/git_command/#stash-all-your-work","title":"stash all your work","text":"<pre><code>git stash\ngit stash list\n</code></pre>"},{"location":"knowledge-base/git_command/#pop-out-your-stash","title":"pop out your stash","text":"<pre><code>git stash pop\ngit stash apply xxx\ngit stash drop xxx\n</code></pre>"},{"location":"knowledge-base/git_command/#git-patch","title":"git patch","text":"<pre><code>git diff &gt; patch\ngit diff HEAD HEAD^ &gt; patch\ngit format-patch HEAD^ \ngit format-patch commit_new commit_old\n\ngit apply patch\ngit apply --check patch\n</code></pre>"},{"location":"knowledge-base/git_command/#remove-the-head-commit","title":"remove the HEAD commit","text":"<pre><code>git reset --hard HEAD^\ngit reset --hard HEAD~100\ngit reset --hard 3628164\n</code></pre>"},{"location":"knowledge-base/git_command/#remove-the-head-commit-softly-all-change-will-be-in-stage","title":"remove the HEAD commit softly, all change will be in stage","text":"<pre><code>git reset --soft HEAD^\n</code></pre>"},{"location":"knowledge-base/git_command/#get-logs","title":"get logs","text":"<pre><code>git log --graph --pretty=oneline --abbrev-commit\n</code></pre>"},{"location":"knowledge-base/git_command/#get-the-deleted-commits-log-it-is-helpful-to-restore-them-if-you-use-git-reset-hard-wrongly","title":"get the deleted commits log, it is helpful to restore them if you use git reset --hard wrongly","text":"<pre><code>git reflog\n</code></pre>"},{"location":"knowledge-base/git_command/#set-head-to-the-specified-commit","title":"set head to the specified commit","text":"<pre><code>git reset --hard commit_id\n</code></pre>"},{"location":"knowledge-base/git_command/#revert-the-specified-commit","title":"revert the specified commit","text":"<pre><code>git revert commit_id\n</code></pre>"},{"location":"knowledge-base/git_command/#merge-commit-into-this-branch-from-other-branches","title":"merge commit into this branch from other branches","text":"<pre><code>git cherry-pick 00940ac970b9ddab63bff928479668bbfa293aaf\n\ngit cherry-pick commit1..commit100\n</code></pre>"},{"location":"knowledge-base/git_command/#merge-one-file-into-this-branch-from-other-branches","title":"merge one file into this branch from other branches","text":"<pre><code>git checkout feature/new1.1 -- usercontroller.php\n</code></pre>"},{"location":"knowledge-base/git_command/#create-new-branch","title":"create new branch","text":"<pre><code>git checkout -b mywork origin\n</code></pre>"},{"location":"knowledge-base/git_command/#create-new-branch-with-remote-branch","title":"create new branch with remote branch","text":"<pre><code>git checkout -b dev origin/dev\n</code></pre>"},{"location":"knowledge-base/git_command/#switch-branch","title":"switch branch","text":"<pre><code>git checkout develop\n</code></pre>"},{"location":"knowledge-base/git_command/#delete-branch","title":"delete branch","text":"<pre><code>git branch -d feature-discuss\n\n// \u5220\u9664\u672c\u5730\u5206\u652f\ngit branch -d localBranchName\n\n// \u5220\u9664\u8fdc\u7a0b\u5206\u652f\ngit push origin --delete remoteBranchName\n</code></pre>"},{"location":"knowledge-base/git_command/#rebase-current-branch-on-origin-branch","title":"rebase current branch on origin branch","text":"<pre><code>git rebase origin\n</code></pre>"},{"location":"knowledge-base/git_command/#merge-another-branch-with-this-branch-will-generate-a-merge-commit-on-top","title":"merge another branch with this branch, will generate a merge commit on top","text":"<pre><code>git merge another_branch\n</code></pre>"},{"location":"knowledge-base/git_command/#merge-another-branch-with-this-branch-without-fast-forward","title":"merge another branch with this branch without fast forward","text":"<pre><code>git merge --no-ff another_branch\n</code></pre>"},{"location":"knowledge-base/git_command/#show-diff","title":"show diff","text":"<pre><code>git diff\n\ngit diff HEAD HEAD^\n\ngit diff HEAD HEAD^ --name-only\n\ngit show HEAD --name-only\n\ngit diff readme.txt\n</code></pre>"},{"location":"knowledge-base/git_command/#position-who-make-revision","title":"position who make revision","text":"<pre><code>git blame xxx\n</code></pre>"},{"location":"knowledge-base/git_command/#add-tag_1","title":"add tag","text":"<pre><code>git tag &lt;tagname&gt;\n# Git will create a tag at the current revision but will not prompt you for an annotation. It will be tagged without a message (this is a lightweight tag).\n\ngit tag -a &lt;tagname&gt;\n# Git will prompt you for an annotation unless you have also used the -m flag to provide a message.\n\ngit tag -a -m &lt;msg&gt; &lt;tagname&gt;\n# Git will tag the commit and annotate it with the provided message.\n\ngit tag -m &lt;msg&gt; &lt;tagname&gt;\n# Git will behave as if you passed the -a flag for annotation and use the provided message.\n</code></pre>"},{"location":"knowledge-base/git_command/#delete-tag","title":"delete tag","text":"<pre><code>git tag -d v1.0\n</code></pre>"},{"location":"knowledge-base/git_command/#config","title":"config","text":"<pre><code>git config --global user.email \"qsfan@qq.com\"\ngit config --global user.user \"fanqingsong\"\n\ngit config --global credential.helper store\n\ngit config --global credential.helper\n\ngit config --unset credential.helper\n\ngit credential-store clean\n</code></pre>"},{"location":"knowledge-base/git_command/#update-locally","title":"update locally","text":"<pre><code>git pull origin next\n\n==\ngit fetch origin master\ngit merge FETCH_HEAD \n</code></pre>"},{"location":"knowledge-base/linux_command/","title":"linux command","text":""},{"location":"knowledge-base/linux_command/#commands","title":"commands","text":"<ul> <li>useful link</li> <li>cheat sheet</li> </ul>"},{"location":"knowledge-base/linux_command/#detect-port-service","title":"detect port service","text":"<pre><code>nc -zv www.baidu.com 80\n</code></pre>"},{"location":"knowledge-base/linux_command/#view-all-service-with-ports","title":"view all service with ports","text":"<pre><code>netstat -antulp\n\n# check appname and pid\nsudo netstat -antulp\n\nsudo ss -tulnp | grep 443\n</code></pre>"},{"location":"knowledge-base/linux_command/#view-process-info","title":"view process info","text":"<pre><code>ps aux | grep pid\n</code></pre>"},{"location":"knowledge-base/linux_command/#scp-command","title":"scp command","text":"<pre><code>#\u4e0b\u8f7d\u8bbe\u5907\u4e2d root \u76ee\u5f55\u4e0b\u7684 test.txt \u5230\u5f53\u524d\u76ee\u5f55\nscp root@192.168.0.111:/root/test.txt ./\n\n #\u4ece\u8bbe\u5907\u4e0b\u8f7d root \u76ee\u5f55\u4e0b\u7684 demo \u6587\u4ef6\u5939\u5230\u5f53\u524d\u76ee\u5f55\nscp -r root@192.168.0.111:/root/demo ./\n\n#\u4e0a\u4f20\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 result.log \u5230\u8bbe\u5907 root \u76ee\u5f55\u4e0b\nscp ./result.log root@192.168.0.111:/root/ \n\n#\u4e0a\u4f20\u5f53\u524d\u76ee\u5f55\u4e0b\u7684 check \u76ee\u5f55\u5230\u8bbe\u5907 root \u76ee\u5f55\nscp -r ./check root@192.168.0.111:/root/\n</code></pre>"},{"location":"knowledge-base/linux_command/#create-soft-link","title":"create soft link","text":"<pre><code>ln -sf /src /dst\n</code></pre>"},{"location":"knowledge-base/linux_command/#switch-to-root-account-if-encountering-such-error","title":"switch to root account if encountering such error","text":"<pre><code># PermissionError: [Errno 13] Permission denied\n\nsudo su\n\nsudo su - postgres\n\nsudo -i -u senthil\n</code></pre>"},{"location":"knowledge-base/linux_command/#user-group","title":"user group","text":"<pre><code>sudo adduser senthil\n\nsudo usermod -g root song\n\nsudo adduser senthil sudo\nsudo usermod -aG sudo senthil\n\nsudo deluser senthil\n</code></pre>"},{"location":"knowledge-base/linux_command/#check-disk-size","title":"check disk size","text":"<pre><code>df -h\n</code></pre>"},{"location":"knowledge-base/linux_command/#find-the-subdirectory-size-of-root","title":"find the subdirectory size of root","text":"<pre><code>du -hx --max-depth=1 / | sort -h -r\n\nhttps://www.cnblogs.com/z1990/p/15179901.html\n</code></pre>"},{"location":"knowledge-base/linux_command/#find-older-files-and","title":"find older files and ....","text":"<pre><code>https://www.cnblogs.com/peida/archive/2012/11/14/2769248.html\n\nfind . -type f -exec ls -l {} \\;\n\nfind . -type f -mtime +14 -exec rm {} \\; \n\nfind . -type d -name __pycache__ -exec rm -r {} \\;\n\nfind . | grep -E \"(/__pycache__$|\\.pyc$|\\.pyo$)\" | xargs rm -rf\n\nfind . -name \"*.log\" -mtime +5 -ok rm {} \\;\n\nfind . -name \"*.log\" -exec mv {} .. \\;\n\nfind . -name \"*.log\" -exec cp {} test3 \\;\n\nfind /var/lib/docker/containers/ -name *-json.log\n\nfind ./ -size +10M -size -20M\n\nfind ~ -size -1G\n</code></pre>"},{"location":"knowledge-base/linux_command/#rsync","title":"rsync","text":"<pre><code>rsync -avz /var/lib/docker /root/dockerlib/\n</code></pre>"},{"location":"knowledge-base/linux_command/#grep","title":"grep","text":"<pre><code>grep nobody /etc/passwd\n\ngrep linuxtechi /etc/passwd /etc/shadow /etc/gshadow\n\n# list all files\ngrep -l 'root' /etc/fstab /etc/passwd /etc/mtab\n\n# display line number\ngrep -n 'nobody' /etc/passwd\n\n# find string with prefix\ngrep ^backup /etc/passwd\n\n# find string with suffix\ngrep bash$ /etc/passwd\n\n# find recursively\nsudo grep -r nobody /etc\n\n# find empty line\ngrep '^$' /etc/sysctl.conf\n\n# ignore lettercase\ngrep -i IP_Forward /etc/sysctl.conf\n\n# find with one word\nsudo sysctl -a | grep -w 'vm.swappiness'\n\n# find with multiple words\ngrep -e nobody -e mail /etc/passwd\ngrep -E \"nobody|mail\" /etc/passwd\n</code></pre>"},{"location":"knowledge-base/mysql_commands/","title":"MySQL Commands","text":""},{"location":"knowledge-base/mysql_commands/#commands","title":"commands","text":"<p>Official</p> <p>W3C</p> <p>Cheatsheet</p>"},{"location":"knowledge-base/mysql_commands/#connect","title":"Connect","text":"<pre><code>mysql -h host -u user -p\n</code></pre>"},{"location":"knowledge-base/mysql_commands/#user-management","title":"user management","text":"<pre><code>SELECT user, host, plugin FROM mysql.user;\n\n\ncreate user 'test_u'@'%' identified by 'kkSWhEpMVZ1xfaebJsRS';\nCREATE USER 'percona'@'localhost' IDENTIFIED BY RANDOM PASSWORD;\n\n\ngrant select,insert,delete,update on db_test.* to 'test_u'@'%' ;\n\n\nALTER USER 'root'@'localhost' IDENTIFIED BY 'new_password';\nALTER USER 'root'@'localhost' IDENTIFIED BY RANDOM PASSWORD;\n\nDROP USER 'jack'@'localhost';\n</code></pre>"},{"location":"knowledge-base/mysql_commands/#delete-foreign-key","title":"delete foreign key","text":"<pre><code>show create table table_name\n\n\nALTER TABLE tb_emp9 DROP FOREIGN KEY fk_emp_dept;\n</code></pre>"},{"location":"knowledge-base/mysql_install_on_WSL/","title":"MySQL Install On WSL","text":""},{"location":"knowledge-base/mysql_install_on_WSL/#commands","title":"commands","text":"<p>source</p>"},{"location":"knowledge-base/mysql_install_on_WSL/#install","title":"install","text":"<pre><code>sudo apt-get install mysql-server\n</code></pre>"},{"location":"knowledge-base/mysql_install_on_WSL/#start","title":"start","text":"<pre><code>sudo service mysql start\n</code></pre>"},{"location":"knowledge-base/mysql_install_on_WSL/#login","title":"login","text":"<pre><code>mysql -u root -p\n</code></pre>"},{"location":"knowledge-base/mysql_install_on_WSL/#open-skip-grant-tables-firstly","title":"open skip-grant-tables firstly","text":"<pre><code>sudo vim /etc/mysql/mysql.conf.d/mysqld.cnf\n</code></pre>"},{"location":"knowledge-base/nodejs/","title":"nodejs command","text":""},{"location":"knowledge-base/nodejs/#commands","title":"commands","text":""},{"location":"knowledge-base/nodejs/#nvm-nodejs-version-management","title":"nvm -- nodejs version management","text":"<pre><code>nvm\nnvm install 14\nnvm alias default 14\n</code></pre>"},{"location":"knowledge-base/nodejs/#n-install-and-switch-node-version","title":"n -- install and switch node version","text":"<pre><code>n\nn 14\n</code></pre>"},{"location":"knowledge-base/python_commands/","title":"machine learning","text":""},{"location":"knowledge-base/python_commands/#commands","title":"commands","text":""},{"location":"knowledge-base/python_commands/#conda","title":"conda","text":"<pre><code>sudo docker run --gpus all --ipc=host --network=host  --name=xxxxx  -v /mnt:/mnt  -it continuumio/anaconda3 bash\n\nconda create -n xxxxx python=3.11\n\nconda env list\n\nconda activate xxxxx\n\nconda deactivate\n\nconda env remove --name xxxxx\n</code></pre>"},{"location":"knowledge-base/python_commands/#uv","title":"uv","text":"<pre><code>uv venv --python=python3.9\n\nsource .venv/bin/activate\n\nuv pip install -r requirements.txt\n\nuv pip install -r pyproject.toml\n\nuv pip sync pyproject.toml\n\nuvicorn svc.main:app --port 5002 --reload\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_alembic/","title":"SQLAlchemy Alembic","text":""},{"location":"knowledge-base/sqlalchemy_alembic/#commands","title":"commands","text":"<p>reference</p> <p>reference</p> <p>official</p>"},{"location":"knowledge-base/sqlalchemy_alembic/#install","title":"install","text":"<pre><code>pip install alembic\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_alembic/#init","title":"init","text":"<pre><code>alembic init alembic\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_alembic/#create-one-revision","title":"create one revision","text":"<pre><code>alembic revision -m \"first create script\"\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_alembic/#migration","title":"migration","text":"<pre><code>alembic upgrade head\uff1a\u5c06\u6570\u636e\u5e93\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c\u3002\nalembic downgrade base\uff1a\u5c06\u6570\u636e\u5e93\u964d\u7ea7\u5230\u6700\u521d\u7248\u672c\u3002\nalembic upgrade &lt;version&gt;\uff1a\u5c06\u6570\u636e\u5e93\u5347\u7ea7\u5230\u6307\u5b9a\u7248\u672c\u3002\nalembic downgrade &lt;version&gt;\uff1a\u5c06\u6570\u636e\u5e93\u964d\u7ea7\u5230\u6307\u5b9a\u7248\u672c\u3002\nalembic upgrade +2\uff1a\u76f8\u5bf9\u5347\u7ea7\uff0c\u5c06\u6570\u636e\u5e93\u5347\u7ea7\u5230\u5f53\u524d\u7248\u672c\u540e\u7684\u4e24\u4e2a\u7248\u672c\u3002\nalembic downgrade -2\uff1a\u76f8\u5bf9\u964d\u7ea7\uff0c\u5c06\u6570\u636e\u5e93\u964d\u7ea7\u5230\u5f53\u524d\u7248\u672c\u524d\u7684\u4e24\u4e2a\u7248\u672c\u3002\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_alembic/#migration-offline","title":"migration offline","text":"<pre><code>alembic upgrade &lt;version&gt; --sql &gt; migration.sql\n\nalembic downgrade head:base --sql\n\nalembic upgrade base:head --sql\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/","title":"SQLAlchemy SQLAlchemy","text":""},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#comparision","title":"Comparision","text":"<p>comparison with others</p> <p>comparison with others</p>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#reference","title":"Reference","text":"<p>Session</p> <p>Relation</p> <p>Column</p> <p>DATA TYPE</p>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#database-url","title":"DATABASE URL","text":"<p>official</p>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#schema","title":"SCHEMA","text":"<pre><code>dialect+driver://username:password@host:port/database\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#mysql","title":"MySQL","text":"<pre><code># default\nengine = create_engine('mysql://scott:tiger@localhost/foo')\n\n# mysqlclient (a maintained fork of MySQL-Python)\nengine = create_engine('mysql+mysqldb://scott:tiger@localhost/foo')\n\n# PyMySQL\nengine = create_engine('mysql+pymysql://scott:tiger@localhost/foo')\n</code></pre>"},{"location":"knowledge-base/sqlalchemy_sqlalchemy/#sqlite","title":"sqlite","text":"<pre><code># Unix/Mac - 4 initial slashes in total\nengine = create_engine('sqlite:////absolute/path/to/foo.db')\n\n# Windows\nengine = create_engine('sqlite:///C:\\\\path\\\\to\\\\foo.db')\n\n# Windows alternative using raw string\nengine = create_engine(r'sqlite:///C:\\path\\to\\foo.db')\n\n# memory\nengine = create_engine('sqlite://')\n</code></pre>"}]}